"use strict";(self.webpackChunksgp=self.webpackChunksgp||[]).push([[438],{87438:(e,t,n)=>{n.r(t),n.d(t,{default:()=>j});n(69070),n(79753),n(82526),n(41817),n(32165),n(66992),n(78783),n(33948),n(47042),n(68309),n(91038),n(47941),n(57327),n(38880),n(89554),n(54747),n(49337),n(33321),n(74916),n(15306),n(27207),n(91058),n(92222),n(82772),n(41539),n(88674),n(35666);var r=n(67294),a=(n(27484),n(42705)),l=n.n(a),o=n(42919),i=n(63386),c=n(23455),m=n(28479),s=(n(96579),n(5368)),u=n(92080),d=n(11382),p=n(32787),f=n(70507),g=n(19650),_=n(71577),b=n(7085),E=(n(26402),n(36904),["emendas","paletesstock","artigo"]),v=["emendas","paletesstock","tempof_id","of_id"];function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,l=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(l.push(r.value),!t||l.length!==t);o=!0);}catch(e){i=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw a}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t,n,r,a,l,o){try{var i=e[l](o),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,a)}function S(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var l=e.apply(t,n);function o(e){C(l,r,a,o,i,"next",e)}function i(e){C(l,r,a,o,i,"throw",e)}o(void 0)}))}}var I=function(e,t){return(0,i.J1)({n_paletes_total:l().number().label("Nº Paletes Total").min(0).required(),nemendas_paletescontentor:l().number().label("Nº Emendas Por Palete/Contentor").min(0).required(),nemendas_rolo:l().number().label("Nº Emendas Por Bobine").min(0).required(),maximo:l().number().label("Percentagem Máxima de Emendas").min(0).required(),tipo_emenda:l().number().label("Tipo Emenda").required(),cliente_cod:l().object().label("Cliente").required()},e,t).unknown(!0)},P=function(){var e=S(regeneratorRuntime.mark((function e(t,n,r){var a,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.SD)({url:"".concat(c.T5,"/materiasprimaslookup/"),filter:{},parameters:{type:"cores",core:t,largura:n},cancelToken:r});case 2:return a=e.sent,l=a.data.rows,e.abrupt("return",l);case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),q=function(){var e=S(regeneratorRuntime.mark((function e(t){var n,r,a,l,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.cliente_cod,r=t.artigo_cod,a=t.token,e.next=3,(0,o.SD)({url:"".concat(c.T5,"/emendaslookup/"),filter:{cliente_cod:n,artigo_cod:r},pagination:{limit:1},sort:[{column:"id",direction:"DESC"}],cancelToken:a});case 3:return l=e.sent,i=l.data.rows,e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=S(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.SD)({url:"".concat(c.T5,"/sellcustomerslookup/"),pagination:{limit:10},filter:O({},"fmulti_customer","%".concat(t.replaceAll(" ","%%"),"%"))});case 2:return n=e.sent,r=n.data.rows,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();const j=function(e){var t=e.record,n=e.setFormTitle,a=e.parentRef,l=e.closeParent,i=e.parentReload,w=x(u.Z.useForm(),1)[0],k=x((0,r.useState)(!1),2),O=k[0],C=(k[1],x((0,r.useState)(!1),2)),j=C[0],A=C[1],z=x((0,r.useState)(!1),2),D=z[0],R=z[1],T=x((0,r.useState)([]),2),L=T[0],F=T[1],Z=function(){var e=t.aggItem.cliente_nome?t.aggItem.cliente_nome:"";n&&n({title:"Definições ".concat(e),subTitle:"".concat(t.aggItem.of_id," - ").concat(t.aggItem.item_cod)}),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.aggItem,r=n.emendas,a=n.paletesstock,l=n.artigo,o=y(n,E),i=o.cliente_cod?{label:o.cliente_nome,cliente_cod:o.cliente_cod}:null,c=e.token;S(regeneratorRuntime.mark((function e(){var t,n,m,s,u,d,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R(!0),e.t0=F,e.next=4,P(l.core,l.lar,c);case 4:if(e.t1=e.sent,(0,e.t0)(e.t1),n={},r.id){e.next=14;break}return e.next=10,q({cliente_cod:o.cliente_cod,artigo_cod:o.item_cod,token:c});case 10:(m=e.sent).length>0&&(n={emendas_id:m[0].id,nemendas_paletescontentor:m[0].paletes_contentor,maximo:m[0].maximo,tipo_emenda:parseInt(m[0].tipo_emenda),nemendas_rolo:m[0].emendas_rolo}),e.next=15;break;case 14:n={emendas_id:r.id,nemendas_paletescontentor:r.paletes_contentor,maximo:r.maximo,tipo_emenda:parseInt(r.tipo_emenda),nemendas_rolo:r.emendas_rolo};case 15:R(!1),s=JSON.parse(o.n_paletes),u=a?a.length:0,d=o.n_paletes_total?o.n_paletes_total:null!=s&&null!==(t=s.total)&&void 0!==t&&t.n_paletes?Math.round(s.total.n_paletes):u,p=d-u,f={key:null==o?void 0:o.core_cod,value:null==o?void 0:o.core_cod,label:null==o?void 0:o.core_des},w.setFieldsValue(h(h({},n),{},{n_paletes_total:d,n_paletes_stock:u,n_paletes_prod:p,cliente_cod:i,core_cod:f,artigo_width:l.lar,artigo_core:l.core,artigo_diam:l.diam_ref,artigo_gram:l.gsm,artigo_des:l.des}));case 22:case"end":return e.stop()}}),e)})))()}()};(0,r.useEffect)((function(){Z()}),[]);var M=function(){var e=S(regeneratorRuntime.mark((function e(n){var r,a,m,s,u,d,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.aggItem,r.emendas,r.paletesstock,a=r.tempof_id,m=r.of_id,s=y(r,v),I().validate(n,{abortEarly:!1}).error){e.next=11;break}return u=s.order_cod?{cliente_nome:s.cliente_nome,cliente_cod:s.cliente_cod}:{cliente_nome:n.cliente_cod.label,cliente_cod:n.cliente_cod.value},d=n.core_cod,p=(d=void 0===d?{}:d).value,f=d.label,e.next=9,(0,o.SD)({url:"".concat(c.T5,"/savetempordemfabrico/"),parameters:h(h(h({type:"settings"},n),{},{core_cod:p,core_des:f},u),{},{artigo_cod:s.item_cod,ofabrico_id:a,ofabrico_cod:m})});case 9:"error"!==e.sent.data.status&&(i({agg_id:s.id}),l());case 11:A(!1);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),V=(0,r.useCallback)(S(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:A(!0),w.submit();case 2:case"end":return e.stop()}}),e)}))),[]);return r.createElement(r.Fragment,null,r.createElement(d.Z,{spinning:D,indicator:r.createElement(b.Z,{style:{fontSize:24},spin:!0}),tip:"A carregar..."},r.createElement(u.Z,{form:w,name:"form-of-settings",onFinish:M,onValuesChange:function(e,n){if("n_paletes_total"in e){var r=t.aggItem.paletesstock,a=r?r.length:0,l=e.n_paletes_total<a?a:e.n_paletes_total,o=l-a;w.setFieldsValue({n_paletes_total:l,n_paletes_prod:o})}},component:"form"},r.createElement(m.lt,{id:"LAY-SETTINGS",guides:O,layout:"vertical",style:{width:"100%",padding:"0px"},schema:I,field:{margin:"2px",overflow:!1,guides:O,label:{enabled:!0,pos:"top",align:"start",vAlign:"center",wrap:!1,overflow:!0,colon:!0,ellipsis:!0},alert:{pos:"right",tooltip:!0,container:!1},layout:{top:"",right:"",center:"",bottom:"",left:""},addons:{},required:!0,style:{alignSelf:"top"}},fieldSet:{guides:O,wide:16,margin:"2px",layout:"horizontal",overflow:!1}},r.createElement(m.bo,{title:"1. Cliente e Artigo"}),r.createElement(m.qL,null),r.createElement(m.C3,{margin:!1,field:{wide:[12]}},r.createElement(m.gN,{forInput:!t.aggItem.order_cod,name:"cliente_cod",required:!1,layout:{center:"align-self:center;",right:"align-self:center;"},label:{enabled:!1,text:"Cliente",pos:"left"}},r.createElement(m.Fb,{placeholder:"Cliente",size:"small",keyField:"BPCNUM_0",textField:"BPCNAM_0",showSearch:!0,showArrow:!0,allowClear:!0,fetchOptions:N}))),r.createElement(m.C3,{margin:!1,field:{wide:[12],forInput:!1}},r.createElement(m.gN,{required:!1,label:{text:"Designação"},name:"artigo_des"},r.createElement(p.Z,{size:"small"}))),r.createElement(m.C3,{margin:!1,field:{wide:[2,2,2,2,"*"],forInput:!1}},r.createElement(m.gN,{required:!1,label:{text:"Largura"},name:"artigo_width"},r.createElement(m.ID,{size:"small",addonAfter:r.createElement("b",null,"mm"),maxLength:4})),r.createElement(m.gN,{required:!1,label:{text:"Diâmetro"},name:"artigo_diam"},r.createElement(m.ID,{size:"small",addonAfter:r.createElement("b",null,"mm"),maxLength:4})),r.createElement(m.gN,{required:!1,label:{text:"Core"},name:"artigo_core"},r.createElement(m.ID,{size:"small",addonAfter:r.createElement("b",null,"''"),maxLength:1})),r.createElement(m.gN,{required:!1,label:{text:"Gramagem"},name:"artigo_gram"},r.createElement(m.ID,{size:"small",addonAfter:r.createElement("b",null,"gsm"),maxLength:4}))),r.createElement(m.qL,{height:"24px"}),r.createElement(m.bo,{title:"2. Core"}),r.createElement(m.qL,null),r.createElement(m.C3,{margin:!1},r.createElement(m.gN,{wide:[10],name:"core_cod",label:{enabled:!1,text:"Core",pos:"top"},required:!1},r.createElement(m.mg,{size:"small",data:L,keyField:"ITMREF_0",textField:"ITMDES1_0",optionsRender:function(e,t,n){return{label:"".concat(e[n]),value:e[t]}},showSearch:!0,labelInValue:!0,filterOption:function(e,t){return t.label.toLowerCase().indexOf(e.toLowerCase())>=0}}))),r.createElement(m.qL,null),r.createElement(m.bo,{title:"3. Nº de Paletes"}),r.createElement(m.qL,null),r.createElement(m.C3,{margin:!1},r.createElement(m.gN,{wide:2,name:"n_paletes_total",label:{text:"Total"}},r.createElement(f.Z,{size:"small",min:0,max:500}))),r.createElement(m.C3,{margin:!1},r.createElement(m.gN,{required:!1,wide:2,name:"n_paletes_stock",label:{text:"Stock"},forInput:!1},r.createElement(f.Z,{size:"small",min:0,max:500})),r.createElement(m.gN,{required:!1,wide:2,name:"n_paletes_prod",label:{text:"A Produzir"},forInput:!1},r.createElement(f.Z,{size:"small",min:0,max:500}))),r.createElement(m.qL,null),r.createElement(m.bo,{title:"4. Emendas"}),r.createElement(m.qL,null),r.createElement(m.C3,{margin:!1,field:{wide:4,style:{alignSelf:"left"},label:{pos:"top",wrap:!1,ellipsis:!1,width:"130px"}},layout:"vertical"},r.createElement(m.gN,{name:"tipo_emenda",label:{text:"Tipo Emenda"}},r.createElement(m.mg,{size:"small",data:c.s7,keyField:"key",textField:"value"})),r.createElement(m.C3,{margin:!1},r.createElement(m.gN,{wide:2,name:"maximo",label:{text:"Máximo"}},r.createElement(f.Z,{size:"small",addonAfter:r.createElement("b",null,"%"),min:0,max:100})),r.createElement(m.gN,{wide:2,label:{text:"Emendas/Rolo"},name:"nemendas_rolo"},r.createElement(f.Z,{size:"small",min:0,max:100})),r.createElement(m.gN,{wide:2,overflow:!0,label:{text:"Paletes/Contentor"},name:"nemendas_paletescontentor"},r.createElement(f.Z,{size:"small",min:0,max:100})))))),a&&r.createElement(s.Z,{elId:a.current},r.createElement(g.Z,null,r.createElement(_.Z,{disabled:j,onClick:V,type:"primary"},"Guardar")))))}}}]);
//# sourceMappingURL=61ff658267298e0214a4.chunk.js.map
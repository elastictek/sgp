{"version":3,"file":"chunks/438/61ff658267298e0214a4.chunk.js","mappings":"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","sources":["webpack://sgp/./src/pages/planeamento/ordemFabrico/FormSettings.jsx"],"sourcesContent":["import React, { useEffect, useState, useCallback, useRef, useContext } from 'react';\r\nimport { createUseStyles } from 'react-jss';\r\nimport styled from 'styled-components';\r\nimport dayjs from 'dayjs';\r\nimport Joi from 'joi';\r\nimport { fetch, fetchPost, cancelToken } from \"utils/fetch\";\r\nimport { getSchema } from \"utils/schemaValidator\";\r\nimport { API_URL } from \"config\";\r\nimport { WrapperForm, TitleForm, FormLayout, Field, FieldSet, Label, LabelField, FieldItem, AlertsContainer, Item, SelectField, InputAddon, VerticalSpace, HorizontalRule, SelectDebounceField } from \"components/formLayout\";\r\nimport Toolbar from \"components/toolbar\";\r\nimport Portal from \"components/portal\";\r\nimport { Button, Spin, Form, Space, Input, InputNumber } from \"antd\";\r\nimport { LoadingOutlined, EditOutlined } from '@ant-design/icons';\r\nimport ResultMessage from 'components/resultMessage';\r\nimport { DATE_FORMAT, DATETIME_FORMAT, TIPOEMENDA_OPTIONS } from 'config';\r\nimport { OFabricoContext } from './FormOFabricoValidar';\r\n\r\nconst schema = (keys, excludeKeys) => {\r\n    return getSchema({\r\n        n_paletes_total: Joi.number().label(\"Nº Paletes Total\").min(0).required(),\r\n        nemendas_paletescontentor: Joi.number().label(\"Nº Emendas Por Palete/Contentor\").min(0).required(),\r\n        nemendas_rolo: Joi.number().label(\"Nº Emendas Por Bobine\").min(0).required(),\r\n        maximo: Joi.number().label(\"Percentagem Máxima de Emendas\").min(0).required(),\r\n        tipo_emenda: Joi.number().label(\"Tipo Emenda\").required(),\r\n        cliente_cod: Joi.object().label(\"Cliente\").required()\r\n    }, keys, excludeKeys).unknown(true);\r\n}\r\n\r\nconst loadCoresLookup = async (core, largura, token) => {\r\n    const { data: { rows } } = await fetchPost({ url: `${API_URL}/materiasprimaslookup/`, filter: {}, parameters: { type: 'cores', core, largura }, cancelToken: token });\r\n    return rows;\r\n}\r\n\r\nconst loadEmendasLookup = async ({ cliente_cod, artigo_cod, token }) => {\r\n    const { data: { rows } } = await fetchPost({ url: `${API_URL}/emendaslookup/`, filter: { cliente_cod, artigo_cod }, pagination: { limit: 1 }, sort: [{ column: 'id', direction: 'DESC' }], cancelToken: token });\r\n    return rows;\r\n}\r\n\r\nconst loadCustomersLookup = async (value) => {\r\n    const { data: { rows } } = await fetchPost({ url: `${API_URL}/sellcustomerslookup/`, pagination: { limit: 10 }, filter: { [\"fmulti_customer\"]: `%${value.replaceAll(' ', '%%')}%` } });\r\n    return rows;\r\n}\r\n\r\nexport default ({ record, setFormTitle, parentRef, closeParent, parentReload }) => {\r\n    const [form] = Form.useForm();\r\n    const [guides, setGuides] = useState(false);\r\n    const [submitting, setSubmitting] = useState(false);\r\n    const [loading, setLoading] = useState(false);\r\n    const [coresLookup, setCoresLookup] = useState([]);\r\n\r\n    const loadData = (data = {}, type = \"init\") => {\r\n        const { emendas, paletesstock, artigo, ...aggItem } = record.aggItem;\r\n        const cliente_cod = (aggItem.cliente_cod) ? { label: aggItem.cliente_nome, cliente_cod: aggItem.cliente_cod } : null;\r\n        const { token } = data;\r\n        switch (type) {\r\n            default:\r\n                (async () => {\r\n                    setLoading(true);\r\n                    setCoresLookup(await loadCoresLookup(artigo.core, artigo.lar, token));\r\n                    let _emendas = {};\r\n                    if (!emendas.id) {\r\n\r\n                        const retEmendas = await loadEmendasLookup({ cliente_cod: aggItem.cliente_cod, artigo_cod: aggItem.item_cod, token });\r\n                        if (retEmendas.length > 0) {\r\n                            _emendas = { emendas_id: retEmendas[0].id, nemendas_paletescontentor: retEmendas[0].paletes_contentor, maximo: retEmendas[0].maximo, tipo_emenda: parseInt(retEmendas[0].tipo_emenda), nemendas_rolo: retEmendas[0].emendas_rolo }\r\n                        }\r\n                    } else {\r\n                        _emendas = { emendas_id: emendas.id, nemendas_paletescontentor: emendas.paletes_contentor, maximo: emendas.maximo, tipo_emenda: parseInt(emendas.tipo_emenda), nemendas_rolo: emendas.emendas_rolo }\r\n                    }\r\n                    setLoading(false);\r\n                    const n_paletes = JSON.parse(aggItem.n_paletes);\r\n                    const n_paletes_stock = !(paletesstock) ? 0 : paletesstock.length;\r\n                    const n_paletes_total = (!aggItem.n_paletes_total) ? (!n_paletes?.total?.n_paletes ? n_paletes_stock : Math.round(n_paletes.total.n_paletes)) : aggItem.n_paletes_total;\r\n                    const n_paletes_prod = n_paletes_total - n_paletes_stock;\r\n                    const core_cod = { key: aggItem?.core_cod, value: aggItem?.core_cod, label: aggItem?.core_des }\r\n                    form.setFieldsValue({\r\n                        ..._emendas, n_paletes_total, n_paletes_stock, n_paletes_prod, cliente_cod, core_cod,\r\n                        artigo_width: artigo.lar, artigo_core: artigo.core, artigo_diam: artigo.diam_ref, artigo_gram: artigo.gsm,\r\n                        artigo_des: artigo.des\r\n                    });\r\n                })();\r\n        }\r\n    }\r\n\r\n    const init = () => {\r\n        const nome = (!record.aggItem.cliente_nome) ? \"\" : record.aggItem.cliente_nome;\r\n        (setFormTitle) && setFormTitle({ title: `Definições ${nome}`, subTitle: `${record.aggItem.of_id} - ${record.aggItem.item_cod}` });\r\n        loadData();\r\n    }\r\n\r\n    useEffect(() => {\r\n        init();\r\n    }, []);\r\n\r\n    const onValuesChange = (changedValues, allValues) => {\r\n        if (\"n_paletes_total\" in changedValues) {\r\n            const { paletesstock } = record.aggItem;\r\n            const n_paletes_stock = !(paletesstock) ? 0 : paletesstock.length;\r\n            const _total = (changedValues.n_paletes_total < n_paletes_stock) ? n_paletes_stock : changedValues.n_paletes_total;\r\n            const n_paletes_prod = _total - n_paletes_stock;\r\n            form.setFieldsValue({ n_paletes_total: _total, n_paletes_prod });\r\n        }\r\n    }\r\n\r\n    const onFinish = async (values) => {\r\n        const { emendas, paletesstock, tempof_id, of_id, ...aggItem } = record.aggItem;\r\n        const v = schema().validate(values, { abortEarly: false });\r\n        if (!v.error) {\r\n            const cliente = (!aggItem.order_cod) ? { cliente_nome: values.cliente_cod.label, cliente_cod: values.cliente_cod.value } : { cliente_nome: aggItem.cliente_nome, cliente_cod: aggItem.cliente_cod };\r\n            const { core_cod: { value: core_cod, label: core_des } = {} } = values;\r\n            const response = await fetchPost({ url: `${API_URL}/savetempordemfabrico/`, parameters: { type: \"settings\", ...values, core_cod, core_des, ...cliente, artigo_cod: aggItem.item_cod, ofabrico_id: tempof_id, ofabrico_cod: of_id } });\r\n            if (response.data.status !== \"error\") {\r\n                parentReload({ agg_id: aggItem.id });\r\n                closeParent();\r\n            }\r\n        }\r\n        setSubmitting(false);\r\n    }\r\n\r\n    const onSubmit = useCallback(async () => {\r\n        setSubmitting(true);\r\n        form.submit();\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            <Spin spinning={loading} indicator={<LoadingOutlined style={{ fontSize: 24 }} spin />} tip=\"A carregar...\">\r\n                <Form form={form} name={`form-of-settings`} onFinish={onFinish} onValuesChange={onValuesChange} component='form'>\r\n                    <FormLayout\r\n                        id=\"LAY-SETTINGS\"\r\n                        guides={guides}\r\n                        layout=\"vertical\"\r\n                        style={{ width: \"100%\", padding: \"0px\"/* , minWidth: \"700px\" */ }}\r\n                        schema={schema}\r\n                        field={{\r\n                            //wide: [3, 2, 1, '*'],\r\n                            margin: \"2px\", overflow: false, guides: guides,\r\n                            label: { enabled: true, pos: \"top\", align: \"start\", vAlign: \"center\", /* width: \"80px\", */ wrap: false, overflow: true, colon: true, ellipsis: true },\r\n                            alert: { pos: \"right\", tooltip: true, container: false /* container: \"el-external\" */ },\r\n                            layout: { top: \"\", right: \"\", center: \"\", bottom: \"\", left: \"\" },\r\n                            addons: {}, //top|right|center|bottom|left\r\n                            required: true,\r\n                            style: { alignSelf: \"top\" }\r\n                        }}\r\n                        fieldSet={{\r\n                            guides: guides,\r\n                            wide: 16, margin: \"2px\", layout: \"horizontal\", overflow: false\r\n                        }}\r\n                    >\r\n\r\n                        <HorizontalRule title=\"1. Cliente e Artigo\" />\r\n                        <VerticalSpace />\r\n                        <FieldSet margin={false} field={{ wide: [12] }}>\r\n                            <Field forInput={record.aggItem.order_cod ? false : true} name=\"cliente_cod\" required={false} layout={{ center: \"align-self:center;\", right: \"align-self:center;\" }} label={{ enabled: false, text: \"Cliente\", pos: \"left\" }}>\r\n                                <SelectDebounceField\r\n                                    placeholder=\"Cliente\"\r\n                                    size=\"small\"\r\n                                    keyField=\"BPCNUM_0\"\r\n                                    textField=\"BPCNAM_0\"\r\n                                    showSearch\r\n                                    showArrow\r\n                                    allowClear\r\n                                    fetchOptions={loadCustomersLookup}\r\n                                />\r\n                            </Field>\r\n                        </FieldSet>\r\n                        <FieldSet margin={false} field={{ wide: [12], forInput: false }}>\r\n                            <Field required={false} label={{ text: \"Designação\" }} name=\"artigo_des\"><Input size=\"small\" /></Field>\r\n                        </FieldSet>\r\n                        <FieldSet margin={false} field={{ wide: [2, 2, 2, 2, '*'], forInput: false }}>\r\n                            <Field required={false} label={{ text: \"Largura\" }} name=\"artigo_width\"><InputAddon size=\"small\" addonAfter={<b>mm</b>} maxLength={4} /></Field>\r\n                            <Field required={false} label={{ text: \"Diâmetro\" }} name=\"artigo_diam\"><InputAddon size=\"small\" addonAfter={<b>mm</b>} maxLength={4} /></Field>\r\n                            <Field required={false} label={{ text: \"Core\" }} name=\"artigo_core\"><InputAddon size=\"small\" addonAfter={<b>''</b>} maxLength={1} /></Field>\r\n                            <Field required={false} label={{ text: \"Gramagem\" }} name=\"artigo_gram\"><InputAddon size=\"small\" addonAfter={<b>gsm</b>} maxLength={4} /></Field>\r\n                        </FieldSet>\r\n                        <VerticalSpace height=\"24px\" />\r\n\r\n\r\n                        <HorizontalRule title=\"2. Core\" />\r\n                        <VerticalSpace />\r\n                        <FieldSet margin={false}>\r\n                            <Field wide={[10]} name=\"core_cod\" label={{ enabled: false, text: \"Core\", pos: \"top\" /* pos: \"left\", width: \"140px\", align: \"end\" */ }} required={false}>\r\n                                <SelectField size=\"small\" data={coresLookup} keyField=\"ITMREF_0\" textField=\"ITMDES1_0\"\r\n                                    optionsRender={(d, keyField, textField) => ({ label: `${d[textField]}`, value: d[keyField] })}\r\n                                    showSearch\r\n                                    labelInValue\r\n                                    filterOption={(input, option) => option.label.toLowerCase().indexOf(input.toLowerCase()) >= 0}\r\n                                />\r\n                            </Field>\r\n                        </FieldSet>\r\n                        <VerticalSpace />\r\n                        <HorizontalRule title=\"3. Nº de Paletes\" />\r\n                        <VerticalSpace />\r\n                        <FieldSet margin={false}>\r\n                            <Field wide={2} name=\"n_paletes_total\" label={{ text: \"Total\" }}><InputNumber size=\"small\" min={0} max={500} /></Field>\r\n                        </FieldSet>\r\n                        <FieldSet margin={false}>\r\n                            <Field required={false} wide={2} name=\"n_paletes_stock\" label={{ text: \"Stock\" }} forInput={false}><InputNumber size=\"small\" min={0} max={500} /></Field>\r\n                            <Field required={false} wide={2} name=\"n_paletes_prod\" label={{ text: \"A Produzir\" }} forInput={false}><InputNumber size=\"small\" min={0} max={500} /></Field>\r\n                        </FieldSet>\r\n                        <VerticalSpace />\r\n                        <HorizontalRule title=\"4. Emendas\" />\r\n                        <VerticalSpace />\r\n                        <FieldSet margin={false} field={{ wide: 4, style: { alignSelf: \"left\" }, label: { pos: \"top\", wrap: false, ellipsis: false, width: \"130px\" } }} layout=\"vertical\">\r\n                            <Field name=\"tipo_emenda\" label={{ text: \"Tipo Emenda\" }}>\r\n                                <SelectField size=\"small\" data={TIPOEMENDA_OPTIONS} keyField=\"key\" textField=\"value\" />\r\n                            </Field>\r\n                            <FieldSet margin={false}>\r\n                                <Field wide={2} name=\"maximo\" label={{ text: \"Máximo\" }}><InputNumber size=\"small\" addonAfter={<b>%</b>} min={0} max={100} /></Field>\r\n                                <Field wide={2} label={{ text: \"Emendas/Rolo\" }} name=\"nemendas_rolo\"><InputNumber size=\"small\" min={0} max={100} /></Field>\r\n                                <Field wide={2} overflow={true} label={{ text: \"Paletes/Contentor\" }} name=\"nemendas_paletescontentor\"><InputNumber size=\"small\" min={0} max={100} /></Field>\r\n                            </FieldSet>\r\n                        </FieldSet>\r\n\r\n\r\n                    </FormLayout>\r\n                </Form>\r\n                {parentRef && <Portal elId={parentRef.current}>\r\n                    <Space>\r\n                        <Button disabled={submitting} onClick={onSubmit} type=\"primary\">Guardar</Button>\r\n                        {/* <Button onClick={() => setGuides(!guides)}>{guides ? \"No Guides\" : \"Guides\"}</Button> */}\r\n                    </Space>\r\n                </Portal>\r\n                }\r\n            </Spin>\r\n        </>\r\n    );\r\n}"],"names":["schema","keys","excludeKeys","getSchema","n_paletes_total","Joi","label","min","required","nemendas_paletescontentor","nemendas_rolo","maximo","tipo_emenda","cliente_cod","unknown","loadCoresLookup","core","largura","token","fetchPost","url","API_URL","filter","parameters","type","cancelToken","rows","data","loadEmendasLookup","artigo_cod","pagination","limit","sort","column","direction","loadCustomersLookup","value","replaceAll","record","setFormTitle","parentRef","closeParent","parentReload","form","Form","useState","guides","submitting","setSubmitting","loading","setLoading","coresLookup","setCoresLookup","init","nome","aggItem","cliente_nome","title","subTitle","of_id","item_cod","emendas","paletesstock","artigo","lar","_emendas","id","retEmendas","length","emendas_id","paletes_contentor","parseInt","emendas_rolo","n_paletes","JSON","parse","n_paletes_stock","total","Math","round","n_paletes_prod","core_cod","key","core_des","setFieldsValue","artigo_width","artigo_core","artigo_diam","diam_ref","artigo_gram","gsm","artigo_des","des","loadData","useEffect","onFinish","values","tempof_id","validate","abortEarly","error","cliente","order_cod","ofabrico_id","ofabrico_cod","status","agg_id","onSubmit","useCallback","submit","spinning","indicator","style","fontSize","spin","tip","name","onValuesChange","changedValues","allValues","_total","component","layout","width","padding","field","margin","overflow","enabled","pos","align","vAlign","wrap","colon","ellipsis","alert","tooltip","container","top","right","center","bottom","left","addons","alignSelf","fieldSet","wide","forInput","text","placeholder","size","keyField","textField","showSearch","showArrow","allowClear","fetchOptions","addonAfter","maxLength","height","optionsRender","d","labelInValue","filterOption","input","option","toLowerCase","indexOf","max","TIPOEMENDA_OPTIONS","elId","current","disabled","onClick"],"sourceRoot":""}
"use strict";(self.webpackChunksgp=self.webpackChunksgp||[]).push([[709],{77709:(e,t,n)=>{n.r(t),n.d(t,{default:()=>N});n(43371),n(33321),n(69070),n(82526),n(57327),n(38880),n(49337),n(79753),n(41817),n(32165),n(66992),n(78783),n(33948),n(91038),n(68309),n(41539),n(88674),n(17727),n(92222),n(69600),n(47042),n(74916),n(23123),n(47941),n(21249),n(82772),n(40561),n(89554),n(54747),n(35666);var r,a,o=n(67294),i=n(85458),l=(n(27484),n(42705),n(42919)),c=n(19258),u=n(96579),f=n(14683),s=n(48086),d=n(71577),m=n(11382),p=n(73171),y=n(7085),g=n(43347),h=n(23455),v=n(66204),b=["form","guides","schema","fieldStatus"];function w(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||O(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,o=[],i=!0,l=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){l=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(l)throw a}}return o}(e,t)||O(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){if(e){if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){A(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function C(e,t,n,r,a,o,i){try{var l=e[o](i),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,a)}function T(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){C(o,r,a,i,l,"next",e)}function l(e){C(o,r,a,i,l,"throw",e)}i(void 0)}))}}var Z=f.Z.Dragger,_=function(){var e=T(regeneratorRuntime.mark((function e(t){var n,r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.of_id,r=t.token,e.next=3,(0,l.SD)({url:"".concat(h.T5,"/ofattachmentsget/"),filter:{of_id:n},sort:[],cancelToken:r});case 3:return a=e.sent,o=a.data.rows,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),F=i.ZP.div(r||(r=P(["\n    display:flex;\n    flex-direction:row;\n    margin:2px;\n    font-size:11px;\n    padding-bottom:2px;\n    border-bottom:solid 1px #f5f5f5;\n    align-items: center;\n\n    &:hover,\n    &:focus {\n        background-color: #f5f5f5;\n    }\n    .itemtype{\n        flex-basis: 180px;\n\t    flex-grow: 0;\n\t    flex-shrink: 0;\n    }\n    .itemfile{\n        flex:1;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n    }\n    .itemfile span{\n        color:#2f54eb;\n        cursor:pointer;\n        font-weight:700;\n    }\n    .itemremove{\n        flex-basis: 30px;\n        flex-grow: 0;\n        flex-shrink: 0;\n        cursor:pointer;\n    }\n    .itemremove span:hover{\n        color:red;\n    }\n"]))),I=(0,i.ZP)(Z)(a||(a=P(["\n    display: flex;\n    flex-direction: row;\n    justify-content: space-around;\n    align-items: center;\n    border-top: 1px solid gray;\n\n    .ant-upload.ant-upload-drag{\n        width: 80%;\n        margin: 20px;\n    }\n    .ant-upload-list.ant-upload-list-picture{\n        width: 100%;\n        margin: 20px;\n    }\n    .ant-upload-list{\n        border-radius: 2px;\n        padding: 10px;\n        border:solid 1px red;\n    }\n"]))),R=function(e){e.originNode;var t=e.file,n=(e.currFileList,e.onRemove),r=(e.attachmentType,e.setAttachmentType);return o.createElement(F,null,o.createElement("div",{className:"itemtype"},o.createElement(c.mg,{onChange:function(e,n){r((function(n){return j(j({},n),{},A({},t.uid,e))}))},defaultValue:h.ry[0].key,style:{width:"170px"},size:"small",data:h.ry,keyField:"value",textField:"value",optionsRender:function(e,t,n){return{label:e[n],value:e[t]}}})),o.createElement("div",{className:"itemfile"},t.name),o.createElement("div",{className:"itemremove",onClick:function(){return n(t)}},o.createElement(p.Z,null)))},D=function(e){var t=e.attachments,n=e.setLoading,r=e.loadData,a=E((0,o.useState)({}),2),i=a[0],f=a[1];return o.createElement(o.Fragment,null,o.createElement(u.Z,{style:{width:"100%"},right:o.createElement(d.Z,{type:"primary",disabled:0==Object.keys(i).length,onClick:function(){n(!0),(0,l.af)({url:"".concat(h.T5,"/ofattachmentschange/"),parameters:{type:"changedtypes",changedTypes:i}}).then((function(e){})).catch((function(e){s.ZP.error("Erro ao Alterar Anexos!")})).finally((function(){n(!1)}))}},"Guardar Alterações")}),t.map((function(e){return o.createElement(F,{key:"attf-".concat(e.id)},o.createElement("a",{className:"itemfile",href:void 0,target:"_blank"},o.createElement("span",null,e.path.split("/").pop())),o.createElement("div",{className:"itemtype"},o.createElement(c.mg,{onChange:function(t,n){return r=e.id,a=t,void f((function(e){return j(j({},e),{},A({},r,a))}));var r,a},defaultValue:e.tipo_doc,style:{width:"170px"},size:"small",data:h.ry,keyField:"value",textField:"value",optionsRender:function(e,t,n){return{label:e[n],value:e[t]}}})),o.createElement("div",{className:"itemremove",onClick:function(){return t=e.id,f((function(e){var n=j({},e);return delete n[t],n})),n(!0),void(0,l.af)({url:"".concat(h.T5,"/ofattachmentschange/"),parameters:{type:"remove",id:t}}).then((function(e){r()})).catch((function(e){s.ZP.error("Erro ao Remover Anexo!")})).finally((function(){n(!1)}));var t}},o.createElement(p.Z,null)))})))};const N=function(e){var t=e.record,n=e.setFormTitle,r=(0,o.useContext)(v.d),a=(r.form,r.guides),i=r.schema,u=(r.fieldStatus,x(r,b),E((0,o.useState)(!0),2)),f=u[0],p=u[1],S=E((0,o.useState)({show:!1}),2),k=(S[0],S[1],E((0,o.useState)([]),2)),A=k[0],P=k[1],C=E((0,o.useState)({}),2),Z=C[0],F=C[1],N=E((0,o.useState)(!1),2),z=N[0],L=N[1],q=E((0,o.useState)([]),2),B=q[0],G=q[1];(0,o.useEffect)((function(){n&&n({title:"Anexos ".concat(t.aggItem.cliente_nome),subTitle:"".concat(t.aggItem.of_id," - ").concat(t.aggItem.item_cod)});var e=(0,l.BO)();return M({token:e}),function(){return e.cancel("Form Attachements Cancelled")}}),[]);var M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.token,r=t.aggItem,a=(r.of_id,r.tempof_id);f||p(!0),T(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=G,e.next=3,_({of_id:a,token:n});case 3:e.t1=e.sent,(0,e.t0)(e.t1),P([]),F({}),L(!1),p(!1);case 9:case"end":return e.stop()}}),e)})))()},U=function(e){F((function(t){var n=j({},t);return delete n[e.uid],n})),P((function(t){var n=t.indexOf(e),r=t.slice();return r.splice(n,1),r}))};return o.createElement(o.Fragment,null,o.createElement(m.Z,{spinning:f,indicator:o.createElement(y.Z,{style:{fontSize:24},spin:!0}),tip:"A carregar..."},o.createElement(c.lt,{id:"LAY-ARTIGOSPECS",guides:a,layout:"vertical",style:{width:"100%",padding:"0px"},schema:i,field:{margin:"2px",overflow:!1,guides:a,label:{enabled:!0,pos:"top",align:"start",vAlign:"center",width:"120px",wrap:!1,overflow:!1,colon:!0,ellipsis:!0},alert:{pos:"right",tooltip:!0,container:!0},layout:{top:"",right:"",center:"",bottom:"",left:""},addons:{},required:!0,style:{alignSelf:"top"}},fieldSet:{guides:a,wide:16,margin:"2px",layout:"horizontal",overflow:!1}},o.createElement(c.C3,{wide:16,margin:!1,layout:"vertical"},o.createElement(D,{attachments:B,setLoading:p,loadData:M})),o.createElement(c.qL,null),o.createElement(c.C3,{wide:16,margin:!1,layout:"vertical"},o.createElement(I,{method:"post",action:"".concat(h.T5,"/ofupload/"),headers:{"X-CSRFToken":h.QO},withCredentials:!0,fileList:A,onChange:function(e){e.newFileList},maxCount:10,beforeUpload:function(e,t){var n,r=[],a={},o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=O(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw o}}}}(t);try{for(o.s();!(n=o.n()).done;){var i=n.value;i.size/1024/1024<h.xC?(i.uid&&(a[i.uid]=h.ry[0].key),r.push(i)):s.ZP.error("O ficheiro tem de ser inferior a ".concat(h.xC,"MB!"))}}catch(e){o.e(e)}finally{o.f()}return F((function(e){return j(j({},e),a)})),P([].concat(w(A),r)),!1},multiple:!0,onRemove:U,itemRender:function(e,t,n){return o.createElement(R,{originNode:e,file:t,currFileList:n,onRemove:U,attachmentType:Z,setAttachmentType:F})}},o.createElement("p",{className:"ant-upload-drag-icon"},o.createElement(g.Z,{style:{color:"green"}})),o.createElement("p",{className:"ant-upload-text"},"Drag files to upload")),o.createElement(d.Z,{type:"primary",onClick:function(){var e=t.aggItem,n=e.of_id,r=e.tempof_id,a=new FormData;a.append("of_id",n),a.append("tempof_id",r),A.forEach((function(e){a.append(e.uid,e),a.append("".concat(e.uid,"_type"),Z[e.uid])})),L(!0),(0,l.af)({url:"".concat(h.T5,"/ofupload/"),parameters:a,headers:{"Content-type":"multipart/form-data"}}).then((function(e){s.ZP.success(e.data.title)})).catch((function(e){s.ZP.error("Erro ao submeter os Ficheiros!")})).finally((function(){M()}))},disabled:0===A.length,loading:z,style:{marginTop:16}},z?"A submeter...":"Submeter")))))}}}]);
"use strict";(self.webpackChunksgp=self.webpackChunksgp||[]).push([[5],{88005:(e,r,t)=>{t.r(r),t.d(r,{default:()=>se});t(82526),t(41817),t(32165),t(66992),t(78783),t(33948),t(47042),t(68309),t(91038),t(74916),t(69070),t(47941),t(38880),t(89554),t(54747),t(49337),t(33321),t(88674),t(82772),t(57327),t(41539),t(79753),t(35666);var n=t(67294),a=(t(27484),t(42705)),o=t.n(a),l=t(42919),i=t(23455),u=t(19258),c=t(96579),s=t(11382),m=t(71577),d=t(7085),f=t(8212),p=(t(19601),t(92222),t(21249),t(56977),t(15306),t(27207),t(26699),t(70189),t(85827),t(69826),t(32023),t(63386)),g=t(54397),b=t(96641),v=t(26402),y=t(5368),_=t(41003),E=t(70507),h=t(32787),w=t(19650),x=t(49101),C=t(5434),A=t(80471),k=t(66204),O=["formu_materiasprimas_A","formu_materiasprimas_BC"],S=["formu_materiasprimas_A","formu_materiasprimas_BC"];function B(e){return function(e){if(Array.isArray(e))return z(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||R(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,r,t,n,a,o,l){try{var i=e[o](l),u=i.value}catch(e){return void t(e)}i.done?r(u):Promise.resolve(u).then(n,a)}function j(e){return function(){var r=this,t=arguments;return new Promise((function(n,a){var o=e.apply(r,t);function l(e){F(o,n,a,l,i,"next",e)}function i(e){F(o,n,a,l,i,"throw",e)}l(void 0)}))}}function N(){return N=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},N.apply(this,arguments)}function P(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==t)return;var n,a,o=[],l=!0,i=!1;try{for(t=t.call(e);!(l=(n=t.next()).done)&&(o.push(n.value),!r||o.length!==r);l=!0);}catch(e){i=!0,a=e}finally{try{l||null==t.return||t.return()}finally{if(i)throw a}}return o}(e,r)||R(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function q(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function Z(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?q(Object(t),!0).forEach((function(r){L(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):q(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function T(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=R(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,i=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return l=e.done,e},e:function(e){i=!0,o=e},f:function(){try{l||null==t.return||t.return()}finally{if(i)throw o}}}}function R(e,r){if(e){if("string"==typeof e)return z(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?z(e,r):void 0}}function z(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function I(e,r){if(null==e)return{};var t,n,a=function(e,r){if(null==e)return{};var t,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||(a[t]=e[t]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}function L(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var M=function(e,r){return(0,p.J1)({formu_materiasprimas_A:o().array().label("Matérias Primas da Extrusora A").min(1).required(),formu_materiasprimas_BC:o().array().label("Matérias Primas das Extrusoras B & C").min(1).required(),matprima_cod_A:o().string().label("Matéria Prima").required(),densidade_A:o().number().label("Densidade").required(),mangueira_A:o().string().label("Mangueira Extrusora A").required(),arranque_A:o().number().label("Arranque").required(),matprima_cod_BC:o().string().label("Matéria Prima").required(),densidade_BC:o().number().label("Densidade").required(),arranque_BC:o().number().label("Arranque").required(),mangueira_BC:o().string().label("Mangueira Extrusora BC").required()},e,r).unknown(!0)},D=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return e?"".concat(t).concat(e).concat(r):n},V=function(e){var r,t=e.backgroundColor,a=void 0===t?"#f5f5f5":t,o=e.color,l=void 0===o?"#000":o,i=e.border,c=void 0===i?"solid 1px #d9d9d9":i;return n.createElement(u.C3,{wide:16,layout:"horizontal",margin:!1,style:{backgroundColor:"".concat(a),color:"".concat(l),fontWeight:500,textAlign:"center"},field:{noItemWrap:!0,label:{enabled:!1}}},n.createElement(u.C3,{wide:7,margin:!1,field:{wide:[13,3],style:{border:c,borderLeft:"none",alignSelf:"stretch",display:"flex",flexDirection:"column",justifyContent:"center"}}},n.createElement(u.gN,{style:{border:c,alignSelf:"stretch",display:"flex",flexDirection:"column",justifyContent:"center"}},"Matérias Primas"),n.createElement(u.gN,null,"Densidade")),n.createElement(u.C3,(L(r={margin:!1,wide:9},"margin",!1),L(r,"layout","vertical"),L(r,"field",{style:{border:c,borderLeft:"none"}}),r),n.createElement(u.C3,{field:{wide:[16]},margin:!1},n.createElement(u.gN,null,"Distribuição por Extrusora")),n.createElement(u.C3,{margin:!1,field:{wide:[4,4,4,3,1],style:{fontSize:"10px",border:c,borderLeft:"none",borderTop:"none",fontWeight:400}}},n.createElement(u.gN,null,"%A"),n.createElement(u.gN,null,"Arranque"),n.createElement(u.gN,null,"Tolerância"),n.createElement(u.gN,null,"% Global"),n.createElement(u.gN,null))))},G=function(e){var r=e.backgroundColor,t=void 0===r?"#f5f5f5":r,a=e.color,o=void 0===a?"#000":a,l=e.border,i=void 0===l?"solid 1px #d9d9d9":l;return n.createElement(u.C3,{wide:16,layout:"horizontal",margin:!1,field:{noItemWrap:!0,label:{enabled:!1}},style:{fontSize:"10px",backgroundColor:"".concat(t),color:"".concat(o),textAlign:"center"}},n.createElement(u.C3,{wide:7,margin:!1,field:{wide:[13,3],style:{border:i,borderLeft:"none"}}},n.createElement(u.gN,{style:{border:i}}),n.createElement(u.gN,null)),n.createElement(u.C3,L({margin:!1,wide:9},"margin",!1),n.createElement(u.C3,{margin:!1,field:{wide:[4,4,4,3,1],label:{enabled:!1},style:{border:i,borderLeft:"none"}}},n.createElement(u.gN,null,"%B e C"),n.createElement(u.gN,null,"Arranque"),n.createElement(u.gN,null,"Tolerância"),n.createElement(u.gN,null,"% Global"),n.createElement(u.gN,null))))},W=function(e){var r,t=e.values,n=void 0===t?{}:t,a=e.adjust,o=void 0===a?{extrusora:null,index:null}:a,l=e.action,u=void 0===l?"adjust":l,c=n.formu_materiasprimas_A,s=void 0===c?[]:c,m=n.formu_materiasprimas_BC,d=void 0===m?[]:m,f=I(n,O),p=i.VA[0],g=i.VA[1],b=0,v=0,y=0,_=0,E=T(s.entries());try{for(E.s();!(r=E.n()).done;){var h=P(r.value,2),w=h[0],x=h[1],C=x.arranque_A?x.arranque_A:0,A=p*C/100;("adjust"===u&&"A"!==o.extrusora||"adjust"!==u||"adjust"===u&&o.index!==w&&"A"===o.extrusora)&&(b+=A,y+=C),x.global=A}}catch(e){E.e(e)}finally{E.f()}var k,S=T(d.entries());try{for(S.s();!(k=S.n()).done;){var B=P(k.value,2),F=B[0],j=B[1],N=j.arranque_BC?j.arranque_BC:0,q=g*N/100;("adjust"===u&&"BC"!==o.extrusora||"adjust"!==u||"adjust"===u&&o.index!==F&&"BC"===o.extrusora)&&(v+=q,_+=N),j.global=q}}catch(e){S.e(e)}finally{S.f()}return"adjust"===u&&("A"===o.extrusora?(s[o.index].arranque_A=100-y<0?0:100-y,s[o.index].global=p*s[o.index].arranque_A/100,b+=s[o.index].global):(d[o.index].arranque_BC=100-_<0?0:100-_,d[o.index].global=g*d[o.index].arranque_BC/100,v+=d[o.index].global)),Z(Z({},f),{},{formu_materiasprimas_A:s,formu_materiasprimas_BC:d,totalGlobal:b+v})},U=function(e){var r=e.form,t=e.forInput,a=e.name,o=e.matPrimasLookup,l=e.sum,c=void 0!==l&&l,s=e.border,d=void 0===s?"solid 1px #d9d9d9":s,f=e.id;return n.createElement(_.Z.List,{name:a},(function(e,l){var s=l.add,p=l.remove;l.move;return n.createElement(n.Fragment,null,e.map((function(e,l){var c;return n.createElement(u.C3,{key:e.key,wide:16,layout:"horizontal",margin:!1,field:{label:{enabled:!1}}},n.createElement(u.C3,{wide:7,margin:!1,field:{wide:[2,11,3],style:{border:"solid 1px #fff",borderLeft:"none",fontWeight:"10px"}}},n.createElement(u.gN,{name:[e.name,"mangueira_".concat(f)]},n.createElement(u.mg,{size:"small",data:i.Pe[f],keyField:"key",textField:"key",optionsRender:function(e,r,t){return{label:"".concat(e[t]),value:e[r]}}})),n.createElement(u.gN,{name:[e.name,"matprima_cod_".concat(f)]},n.createElement(u.mg,{size:"small",data:o,keyField:"ITMREF_0",textField:"ITMDES1_0",optionsRender:function(e,r,t){return{label:"".concat(e[t]),value:e[r]}},showSearch:!0,filterOption:function(e,r){return r.label.toLowerCase().indexOf(e.toLowerCase())>=0}})),n.createElement(u.gN,{name:[e.name,"densidade_".concat(f)]},n.createElement(E.Z,{controls:!1,size:"small",min:0,max:50,precision:3,step:.025}))),n.createElement(u.C3,L({margin:!1,wide:9},"margin",!1),n.createElement(u.C3,{margin:!1,field:{wide:[4,4,4,3,1],label:{enabled:!1},style:{border:"solid 1px #fff",borderLeft:"none",borderTop:"none"}}},n.createElement(u.gN,null),n.createElement(u.gN,{name:[e.name,"arranque_".concat(f)]},n.createElement(E.Z,N({size:"small",controls:!1},t&&{addonBefore:n.createElement(b.Z,{onClick:function(){return e=l,t=f,n=W({values:r.getFieldsValue(!0),adjust:{extrusora:t,index:e},action:"adjust"}),void r.setFieldsValue(n);var e,t,n}},n.createElement(C.fan,null))},{addonAfter:n.createElement("b",null,"%"),precision:2,min:0,max:100}))),n.createElement(u.gN,{name:[e.name,"tolerancia_".concat(f)]},n.createElement(E.Z,{size:"small",controls:!1,addonBefore:"±",addonAfter:n.createElement("b",null,"%"),maxLength:4,precision:1,min:0,max:100})),n.createElement(u.gN,{style:{textAlign:"center",border:"solid 1px #fff",borderLeft:"none",borderTop:"none"}},D(null===(c=r.getFieldValue([a,e.name,"global"]))||void 0===c?void 0:c.toFixed(2),"%")),n.createElement(u.mZ,{label:{enabled:!1}},t&&n.createElement(b.Z,{onClick:function(){return r=e.name,void p(r);var r},style:{alignSelf:"center"}},n.createElement(A.dc5,null))))))})),c&&r.getFieldValue("totalGlobal")>0&&n.createElement(u.C3,{wide:16,layout:"horizontal",margin:!1,field:{label:{enabled:!1}}},n.createElement(u.C3,{wide:7,margin:!1}),n.createElement(u.C3,L({margin:!1,wide:9},"margin",!1),n.createElement(u.C3,{margin:!1,field:{wide:[12,4],label:{enabled:!1},style:{border:"solid 1px #fff",borderLeft:"none",borderTop:"none"}}},n.createElement(u.gN,null),n.createElement(u.gN,{style:{marginTop:"4px",textAlign:"center",fontWeight:500,border:d}},D(r.getFieldValue("totalGlobal").toFixed(2),"%"))))),n.createElement(u.C3,null,t&&n.createElement(m.Z,{type:"dashed",onClick:function(){var e;s((L(e={},"tolerancia_".concat(f),i.d4),L(e,"removeCtrl",!0),e))},style:{width:"100%"}},n.createElement(x.Z,null),"Adicionar")))}))},K=function(){var e=j(regeneratorRuntime.mark((function e(r){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.SD)({url:"".concat(i.T5,"/materiasprimaslookup/"),filter:{}});case 2:return t=e.sent,n=t.data.rows,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),J=function(){var e=j(regeneratorRuntime.mark((function e(r){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.SD)({url:"".concat(i.T5,"/sellcustomerslookup/"),pagination:{limit:10},filter:L({},"fmulti_customer","%".concat(r.replaceAll(" ","%%"),"%"))});case 2:return t=e.sent,n=t.data.rows,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();const Y=function(e){var r,t=e.record,a=e.setFormTitle,o=e.parentRef,c=e.closeParent,s=e.parentReload,d=e.wrapForm,f=void 0===d?"form":d,p=e.forInput,b=void 0===p||p,x=(0,n.useContext)(k.d),C=P(_.Z.useForm(),1)[0],A=P((0,n.useState)(!0),2),O=(A[0],A[1]),F=P((0,n.useState)({}),2),N=(F[0],F[1]),q=P((0,n.useState)({error:[],warning:[],info:[],success:[]}),2),R=q[0],z=q[1],L=P((0,n.useState)(!1),2),D=L[0],Y=L[1],$=P((0,n.useState)((r=t.formulacao_id)?{key:"update",values:{id:r}}:{key:"insert",values:{}}),2),H=$[0],Q=($[1],P((0,n.useState)({status:"none"}),2)),X=Q[0],ee=Q[1],re=P((0,n.useState)([]),2),te=re[0],ne=re[1],ae=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];j(regeneratorRuntime.mark((function r(){var n,o,l,u;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e){r.next=6;break}return r.t0=ne,r.next=4,K(t);case 4:r.t1=r.sent,(0,r.t0)(r.t1);case 6:"update"===H.key?(a&&a({title:"Editar Formulação"}),l=null===(n=t.formulacaoMatPrimas)||void 0===n?void 0:n.filter((function(e){return"A"===e.extrusora})).map((function(e){return{global:e.vglobal,mangueira_A:e.mangueira,matprima_cod_A:e.matprima_cod,densidade_A:e.densidade,arranque_A:e.arranque,tolerancia_A:e.tolerancia,removeCtrl:!0}})),u=null===(o=t.formulacaoMatPrimas)||void 0===o?void 0:o.filter((function(e){return"BC"===e.extrusora})).map((function(e){return{global:e.vglobal,mangueira_BC:e.mangueira,matprima_cod_BC:e.matprima_cod,densidade_BC:e.densidade,arranque_BC:e.arranque,tolerancia_BC:e.tolerancia,removeCtrl:!0}})),C.setFieldsValue(Z(Z({},t.formulacao),{},{formu_materiasprimas_A:l,formu_materiasprimas_BC:u,totalGlobal:100}))):(a&&a({title:"Nova Formulação ".concat(x.item_cod),subTitle:"".concat(x.item_nome)}),C.setFieldsValue({extr0:i.wp[0],extr1:i.wp[1],extr2:i.wp[2],extr3:i.wp[3],extr4:i.wp[4],extr0_val:i.aN[0],extr1_val:i.aN[1],extr2_val:i.aN[2],extr3_val:i.aN[3],extr4_val:i.aN[4]})),O(!1);case 8:case"end":return r.stop()}}),r)})))()};(0,n.useEffect)((function(){return ae(!0),function(){return ne([])}}),[]);var oe=function(){var e=j(regeneratorRuntime.mark((function e(r){var n,a,o,u,c,m,d,f,p,g,b,v,y,_,E,h,w,C,A,k,O,S,F;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=[],u={error:[],warning:[],info:[],success:[]},c=["formu_materiasprimas_A","formu_materiasprimas_BC"],m=M(!1,["mangueira_A","matprima_cod_A","densidade_A","arranque_A","mangueira_BC","matprima_cod_BC","densidade_BC","arranque_BC"]).validate(r,{abortEarly:!1}),u.error=[].concat(B(u.error),B(m.error?null===(n=m.error)||void 0===n?void 0:n.details.filter((function(e){return c.includes(e.context.key)})):[])),u.warning=[].concat(B(u.warning),B(m.warning?null===(a=m.warning)||void 0===a?void 0:a.details.filter((function(e){return c.includes(e.context.key)})):[])),m.error||(d=W({values:r,action:"finish"}),f=d.formu_materiasprimas_A.map((function(e){return e.mangueira_A})),p=d.formu_materiasprimas_BC.map((function(e){return e.mangueira_BC})),new Set(f).size!==f.length?u.error.push({message:"As mangueiras na Extrusora A, não podem estar duplicadas!"}):new Set(p).size!==p.length&&u.error.push({message:"As mangueiras na Extrusora BC, não podem estar duplicadas!"}),g=d.formu_materiasprimas_A.reduce((function(e,r){return e+(r.arranque_A||0)}),0),b=d.formu_materiasprimas_BC.reduce((function(e,r){return e+(r.arranque_BC||0)}),0),100!==d.totalGlobal?u.error.push({message:"O Total Global das Matérias Primas tem de ser 100%!"}):100!==g?u.error.push({message:"O Total das Matérias Primas da Extrusora A tem de ser 100%!"}):100!==b&&u.error.push({message:"O Total das Matérias Primas das Extrusoras B&C tem de ser 100%!"})),0!==u.error.length||!d){e.next=21;break}_=T(null===(v=d)||void 0===v?void 0:v.formu_materiasprimas_A);try{for(h=function(){var e,r=E.value,t=null===(e=te.find((function(e){return e.ITMREF_0===r.matprima_cod_A})))||void 0===e?void 0:e.ITMDES1_0;o.push({tolerancia:r.tolerancia_A,arranque:r.arranque_A,vglobal:r.global,densidade:r.densidade_A,mangueira:r.mangueira_A,extrusora:"A",matprima_cod:r.matprima_cod_A,matprima_des:t})},_.s();!(E=_.n()).done;)h()}catch(e){_.e(e)}finally{_.f()}w=T(null===(y=d)||void 0===y?void 0:y.formu_materiasprimas_BC);try{for(A=function(){var e,r=C.value,t=null===(e=te.find((function(e){return e.ITMREF_0===r.matprima_cod_BC})))||void 0===e?void 0:e.ITMDES1_0;o.push({tolerancia:r.tolerancia_BC,arranque:r.arranque_BC,vglobal:r.global,densidade:r.densidade_BC,mangueira:r.mangueira_BC,extrusora:"BC",matprima_cod:r.matprima_cod_BC,matprima_des:t})},w.s();!(C=w.n()).done;)A()}catch(e){w.e(e)}finally{w.f()}return k=r.cliente_cod,O=(k=void 0===k?{}:k).value,S=k.label,e.next=18,(0,l.SD)({url:"".concat(i.T5,"/newformulacao/"),parameters:Z(Z({},r),{},{items:o,produto_id:x.produto_id,cliente_cod:O,cliente_nome:S})});case 18:"error"!==(F=e.sent).data.status&&s({formulacao_id:t.formulacao_id},"init"),ee(F.data);case 21:z(u);case 22:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),le=function(){c()};return n.createElement(n.Fragment,null,n.createElement(v.Z,{result:X,successButtonOK:"insert"===H.key&&n.createElement(m.Z,{type:"primary",key:"goto-of",onClick:function(){"insert"===H.key&&(C.resetFields(),ae(),ee({status:"none"}))}},"Criar Nova Formulação"),successButtonClose:n.createElement(m.Z,{key:"goto-close",onClick:function(){return le(!0)}},"Fechar"),errorButtonOK:n.createElement(m.Z,{type:"primary",key:"goto-ok",onClick:function(){ee({status:"none"})}},"OK"),errorButtonClose:n.createElement(m.Z,{key:"goto-close",onClick:le},"Fechar")},n.createElement(u.NH,{id:"el-external"}),n.createElement(g.Z,{formStatus:R}),n.createElement(_.Z,{form:C,name:"fps",onFinish:oe,onValuesChange:function(e,r){var t=r.formu_materiasprimas_A,n=void 0===t?[]:t,a=r.formu_materiasprimas_BC,o=void 0===a?[]:a,l=I(r,S),i=n.filter((function(e){return!0===e.removeCtrl})),u=o.filter((function(e){return!0===e.removeCtrl})),c=W({values:Z(Z({},l),{},{formu_materiasprimas_A:i,formu_materiasprimas_BC:u}),action:"valueschange"});C.setFieldsValue(c),N(e)},component:f},n.createElement(u.lt,{id:"LAY-FORMULACAO-UPSERT",guides:D,layout:"vertical",style:{width:"100%",padding:"0px"},schema:M,field:{forInput:b,wide:[16],margin:"2px",overflow:!1,guides:D,label:{enabled:!0,pos:"top",align:"start",vAlign:"center",wrap:!1,overflow:!1,colon:!0,ellipsis:!0},alert:{pos:"right",tooltip:!0,container:!1},layout:{top:"",right:"",center:"",bottom:"",left:""},required:!0,style:{alignSelf:"top"}},fieldSet:{guides:D,wide:16,margin:"2px",layout:"horizontal",overflow:!1}},b&&n.createElement(n.Fragment,null,n.createElement(u.C3,{margin:!1,field:{wide:[6,8]}},n.createElement(u.gN,{name:"designacao",label:{enabled:!1}},n.createElement(h.Z,{placeholder:"Designação",size:"small"})),n.createElement(u.gN,{name:"cliente_cod",required:!1,layout:{center:"align-self:center;",right:"align-self:center;"},label:{enabled:!1,text:"Cliente",pos:"left"}},n.createElement(u.Fb,{placeholder:"Cliente",size:"small",keyField:"BPCNUM_0",textField:"BPCNAM_0",showSearch:!0,showArrow:!0,allowClear:!0,fetchOptions:J}))),n.createElement(u.qL,{height:"24px"})),!b&&n.createElement(n.Fragment,null,n.createElement(u.C3,{margin:!1,field:{wide:[9,7]}},n.createElement(u.gN,{name:"cliente_cod",required:!1,layout:{center:"align-self:center;",right:"align-self:center;"},label:{enabled:!1,text:"Cliente",pos:"left"}},n.createElement(u.Fb,{placeholder:"Cliente",size:"small",keyField:"BPCNUM_0",textField:"BPCNAM_0",showSearch:!0,showArrow:!0,allowClear:!0,fetchOptions:J}))),n.createElement(u.qL,{height:"24px"})),n.createElement(u.C3,{wide:16,margin:!1},n.createElement(u.C3,{wide:3}),n.createElement(u.C3,{wide:10,margin:!1,layout:"vertical",field:{split:5,wide:void 0}},n.createElement(u.C3,{margin:!1},n.createElement(u.gN,{name:"extr0",label:{enabled:!1}},n.createElement(h.Z,{disabled:!0,size:"small"})),n.createElement(u.gN,{name:"extr1",label:{enabled:!1}},n.createElement(h.Z,{disabled:!0,size:"small"})),n.createElement(u.gN,{name:"extr2",label:{enabled:!1}},n.createElement(h.Z,{disabled:!0,size:"small"})),n.createElement(u.gN,{name:"extr3",label:{enabled:!1}},n.createElement(h.Z,{disabled:!0,size:"small"})),n.createElement(u.gN,{name:"extr4",label:{enabled:!1}},n.createElement(h.Z,{disabled:!0,size:"small"}))),n.createElement(u.C3,{margin:!1},n.createElement(u.gN,{name:"extr0_val",label:{enabled:!1}},n.createElement(E.Z,{disabled:!0,size:"small",addonAfter:n.createElement("b",null,"%"),maxLength:4})),n.createElement(u.gN,{name:"extr1_val",label:{enabled:!1}},n.createElement(E.Z,{disabled:!0,size:"small",addonAfter:n.createElement("b",null,"%"),maxLength:4})),n.createElement(u.gN,{name:"extr2_val",label:{enabled:!1}},n.createElement(E.Z,{disabled:!0,size:"small",addonAfter:n.createElement("b",null,"%"),maxLength:4})),n.createElement(u.gN,{name:"extr3_val",label:{enabled:!1}},n.createElement(E.Z,{disabled:!0,size:"small",addonAfter:n.createElement("b",null,"%"),maxLength:4})),n.createElement(u.gN,{name:"extr4_val",label:{enabled:!1}},n.createElement(E.Z,{disabled:!0,size:"small",addonAfter:n.createElement("b",null,"%"),maxLength:4})))),n.createElement(u.C3,{wide:3})),n.createElement(u.qL,{height:"12px"}),n.createElement(V,null),n.createElement(U,{form:C,name:"formu_materiasprimas_A",forInput:b,matPrimasLookup:te,id:"A"}),n.createElement(G,null),n.createElement(U,{form:C,name:"formu_materiasprimas_BC",forInput:b,matPrimasLookup:te,sum:!0,id:"BC"}))),o&&n.createElement(y.Z,{elId:o.current},n.createElement(w.Z,null,n.createElement(m.Z,{type:"primary",onClick:function(){return oe(C.getFieldsValue(!0))}},"Guardar"),n.createElement(m.Z,{onClick:function(){return Y(!D)}},D?"No Guides":"Guides")))))};var $=["form","guides","schema","fieldStatus"];function H(e){return function(e){if(Array.isArray(e))return le(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||oe(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(e,r){if(null==e)return{};var t,n,a=function(e,r){if(null==e)return{};var t,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||(a[t]=e[t]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}function X(e,r,t,n,a,o,l){try{var i=e[o](l),u=i.value}catch(e){return void t(e)}i.done?r(u):Promise.resolve(u).then(n,a)}function ee(e){return function(){var r=this,t=arguments;return new Promise((function(n,a){var o=e.apply(r,t);function l(e){X(o,n,a,l,i,"next",e)}function i(e){X(o,n,a,l,i,"throw",e)}l(void 0)}))}}function re(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function te(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?re(Object(t),!0).forEach((function(r){ne(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):re(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function ne(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function ae(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==t)return;var n,a,o=[],l=!0,i=!1;try{for(t=t.call(e);!(l=(n=t.next()).done)&&(o.push(n.value),!r||o.length!==r);l=!0);}catch(e){i=!0,a=e}finally{try{l||null==t.return||t.return()}finally{if(i)throw a}}return o}(e,r)||oe(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oe(e,r){if(e){if("string"==typeof e)return le(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?le(e,r):void 0}}function le(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var ie=function(e){var r=e.showWrapper,t=e.setShowWrapper,a=e.parentReload,o=ae((0,n.useState)({}),2),l=o[0],i=o[1],c=(0,n.useRef)(),s=r.record,m=void 0===s?{}:s,d=function(){t((function(e){return te(te({},e),{},{show:!e.show})}))};return n.createElement(u.JE,{title:n.createElement(u.QF,{title:l.title,subTitle:l.subTitle}),type:"drawer",destroyOnClose:!0,mask:!0,setVisible:d,visible:r.show,width:800,bodyStyle:{height:"450px"},footer:n.createElement("div",{ref:c,id:"form-wrapper",style:{textAlign:"right"}})},n.createElement(Y,{setFormTitle:i,record:m,parentRef:c,closeParent:d,parentReload:a}))},ue=function(){var e=ee(regeneratorRuntime.mark((function e(r){var t,n,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.produto_id,n=r.token,e.next=3,(0,l.SD)({url:"".concat(i.T5,"/formulacoeslookup/"),filter:{produto_id:t},sort:[],cancelToken:n});case 3:return a=e.sent,o=a.data.rows,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),ce=function(){var e=ee(regeneratorRuntime.mark((function e(r){var t,n,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.formulacao_id,n=r.token,t){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,(0,l.SD)({url:"".concat(i.T5,"/formulacaomateriasprimasget/"),filter:{formulacao_id:t},sort:[],cancelToken:n});case 5:return a=e.sent,o=a.data.rows,e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();const se=function(e){var r=e.changedValues,t=(0,n.useContext)(k.d),a=t.form,o=t.guides,i=t.schema,p=(t.fieldStatus,Q(t,$)),g=ae((0,n.useState)(!0),2),b=g[0],v=g[1],y=ae((0,n.useState)({show:!1}),2),_=y[0],E=y[1],h=ae((0,n.useState)([]),2),w=h[0],x=h[1];(0,n.useEffect)((function(){var e=(0,l.BO)();return C({formulacao_id:a.getFieldValue("formulacao_id"),token:e}),function(){return e.cancel("Form Formulação Cancelled")}}),[]),(0,n.useEffect)((function(){var e=(0,l.BO)();return r&&"formulacao_id"in r&&(v(!0),C({formulacao_id:r.formulacao_id,token:e})),function(){return e.cancel("Form Formulação Cancelled")}}),[r]);var C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"init",t=e.formulacao_id,n=e.token;if("lookup"===r)v(!0),ee(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=x,e.next=3,ue({produto_id:p.produto_id,token:n});case 3:e.t1=e.sent,(0,e.t0)(e.t1),v(!1);case 6:case"end":return e.stop()}}),e)})))();else b||v(!0),ee(regeneratorRuntime.mark((function e(){var r,o,l,i,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=w,!p.produto_id){e.next=6;break}return e.next=4,ue({produto_id:p.produto_id,token:n});case 4:r=e.sent,x(r);case 6:if(!t){e.next=13;break}return o=r.filter((function(e){return e.id===t})),l=ae(o,1),i=l[0],e.next=10,ce({formulacao_id:t,token:n});case 10:u=e.sent,i=te(te({},i),{},{cliente_cod:{key:i.cliente_cod,value:i.cliente_cod,label:i.cliente_nome}}),a.setFieldsValue({formulacao:i,formulacaoMatPrimas:H(u)});case 13:v(!1);case 14:case"end":return e.stop()}}),e)})))()},A=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E(e?function(e){return te(te({},e),{},{show:!e.show,record:{},forInput:r})}:function(e){return te(te({},e),{},{show:!e.show,record:te({},a.getFieldsValue(["formulacao_id","formulacao","formulacaoMatPrimas"])),forInput:r})})};return n.createElement(n.Fragment,null,n.createElement(s.Z,{spinning:b,indicator:n.createElement(d.Z,{style:{fontSize:24},spin:!0}),tip:"A carregar..."},n.createElement(ie,{showWrapper:_,setShowWrapper:E,parentReload:C}),n.createElement(u.lt,{id:"LAY-FORMULACAO",guides:o,layout:"vertical",style:{width:"100%",padding:"0px"},schema:i,field:{margin:"2px",overflow:!1,guides:o,label:{enabled:!0,pos:"top",align:"start",vAlign:"center",wrap:!1,overflow:!1,colon:!0,ellipsis:!0},alert:{pos:"right",tooltip:!0,container:!0},layout:{top:"",right:"",center:"",bottom:"",left:""},addons:{},required:!0,style:{alignSelf:"top"}},fieldSet:{guides:o,wide:16,margin:"2px",layout:"horizontal",overflow:!1}},n.createElement(u.C3,null,n.createElement(c.Z,{style:{width:"100%"},left:n.createElement(u.C3,null,n.createElement(u.gN,{name:"formulacao_id",layout:{center:"align-self:center;",right:"align-self:center;"},label:{enabled:!0,text:"Formulacao",pos:"left"},addons:te({},a.getFieldValue("formulacao_id")&&{right:n.createElement(m.Z,{onClick:function(){return A(!1,!0)},style:{marginLeft:"3px"},size:"small"},n.createElement(f.Z,{style:{fontSize:"16px"}}))})},n.createElement(u.mg,{size:"small",data:w,keyField:"id",textField:"designacao",optionsRender:function(e,r,t){return{label:n.createElement("div",{style:{display:"flex"}},n.createElement("div",{style:{minWidth:"150px"}},n.createElement("b",null,e[t])),n.createElement("div",null,"v.",e.versao)),value:e[r]}}}))),right:n.createElement(m.Z,{onClick:function(){return A(!0,!0)}},"Nova Formulação")})),n.createElement(u.C3,null,!b&&a.getFieldValue("formulacao_id")&&n.createElement(Y,{record:a.getFieldsValue(!0),wrapForm:!1,forInput:!1,parentReload:C})))))}}}]);
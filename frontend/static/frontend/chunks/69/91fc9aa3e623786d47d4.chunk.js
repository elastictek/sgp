"use strict";(self.webpackChunksgp=self.webpackChunksgp||[]).push([[69],{46069:(e,t,r)=>{r.r(t),r.d(t,{default:()=>L});r(47042),r(43371),r(33321),r(69070),r(47941),r(82526),r(57327),r(38880),r(49337),r(79753),r(41817),r(32165),r(66992),r(78783),r(33948),r(91038),r(26699),r(32023),r(21249),r(68309),r(82772),r(69600),r(74916),r(23123),r(73210),r(24603),r(39714),r(9653),r(89554),r(41539),r(54747),r(34553),r(92222),r(85827),r(88674),r(35666);var n,a,o=r(67294),l=r(34144),i=(r(42705),r(42919)),u=r(23455),c=r(63386),s=(r(10438),r(28479)),m=r(54397),f=r(26402),d=r(75950),p=r(5368),g=r(71577),y=r(92080),v=r(19650),E=r(60331),b=r(37676);function h(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||w(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,o=[],l=!0,i=!1;try{for(r=r.call(e);!(l=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);l=!0);}catch(e){i=!0,a=e}finally{try{l||null==r.return||r.return()}finally{if(i)throw a}}return o}(e,t)||w(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){if(e){if("string"==typeof e)return k(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?k(e,t):void 0}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){F(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function F(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function S(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _(e,t,r,n,a,o,l){try{var i=e[o](l),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,a)}function R(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function l(e){_(o,n,a,l,i,"next",e)}function i(e){_(o,n,a,l,i,"throw",e)}l(void 0)}))}}var A=function(e,t){return(0,c.J1)({},e,t).unknown(!0)},P=function(){var e=R(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.token,e.next=3,(0,i.SD)({url:"".concat(u.T5,"/materiasprimaslookup/"),filter:{},sort:[],cancelToken:r});case 3:return n=e.sent,a=n.data.rows,e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Z=function(){var e=R(regeneratorRuntime.mark((function e(t,r){var n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.SD)({url:"".concat(u.T5,"/loteslookup/"),pagination:{limit:10},filter:{item_cod:r,loc_cod:"BUFFER",lote_cod:"%".concat(t,"%")}});case 2:return n=e.sent,a=n.data.rows,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),B=function(e){var t=e.value,r=e.extrusoraRef,n=(0,o.useRef)(!1);return(0,o.useEffect)((function(){r.current!==t?(n.current=!0,r.current=t):n.current=!1}),[]),o.createElement(o.Fragment,null,n.current&&o.createElement(s.C3,{wide:16,layout:"horizontal",margin:!1,field:{wide:[8,1.5,1.5,5],label:{enabled:!1}}},o.createElement(s.mZ,null,o.createElement("div",{style:{fontWeight:700,fontSize:"12px"}},"Extrusora ",t)),o.createElement(s.mZ,null,o.createElement("div",{style:{textAlign:"right"}},"Qtd. Requerida")),o.createElement(s.mZ,null,o.createElement("div",{style:{textAlign:"right"}},"Qtd. Disponível")),o.createElement(s.mZ,null,o.createElement("div",{style:{textAlign:"center"}},"Lotes"))))},q=(0,l.ZP)(g.Z).withConfig({shouldForwardProp:function(e){return!["first"].includes(e)}})(n||(n=S(["\n    border-radius:0px !important;\n    ","\n"])),(function(e){var t=e.first;return!(void 0!==t&&t)&&(0,l.iv)(a||(a=S(["border-left: 0px !important;"])))})),I=function(e){var t=e.setExtrusora,r=e.extrusora,n=e.setFocus,a=function(e){t("BC"===r&&"BC"===e?"C":"BC"===r&&"C"===e?"B":e),n()},l=function(e){return e.includes(r)?"primary":"default"};return o.createElement(o.Fragment,null,o.createElement(q,{size:"large",onClick:function(){return a("A")},first:!0,type:l(["A"])},"Extrusora A"),o.createElement(q,{size:"large",onClick:function(){return a("BC")},type:l(["B","BC"])},"Extrusora B"),o.createElement(q,{size:"large",onClick:function(){return a("C")},type:l(["C","BC"])},"Extrusora C"))},T=function(e){var t=e.extrusoraRef,r=e.form,n=e.id,a=e.matPrimasLookup,l="lotes".concat(n);return o.createElement(y.Z.List,{name:l},(function(e,n){n.add,n.remove,n.move;return o.createElement(o.Fragment,null,e.map((function(e,n){var i,c;return o.createElement(o.Fragment,{key:e.key},o.createElement(B,{extrusoraRef:t,value:r.getFieldValue(l)[e.name].extrusora}),o.createElement(s.C3,{wide:16,margin:!1,field:{label:{enabled:!1},style:{alignSelf:"center"},wide:[1,7,1.5,1.5,5]}},o.createElement(s.gN,{name:[e.name,"mangueira"],style:{fontSize:"12px",backgroundColor:"#fff",alignSelf:"center"}},o.createElement(s.mg,{tabIndex:1e3,size:"large",data:u.Pe[r.getFieldValue(l)[e.name].extrusora],keyField:"key",textField:"key",optionsRender:function(e,t,r){return{label:"".concat(e[r]),value:e[t]}}})),o.createElement(s.gN,{name:[e.name,"matprima_cod"],forInput:!1,style:{fontWeight:700,fontSize:"12px",alignSelf:"center"}},o.createElement(s.mg,{size:"large",data:a,keyField:"ITMREF_0",textField:"ITMDES1_0",optionsRender:function(e,t,r){return{label:"".concat(e[r]),value:e[t]}},showSearch:!0,filterOption:function(e,t){return t.label.toLowerCase().indexOf(e.toLowerCase())>=0}})),o.createElement(s.mZ,{style:{textAlign:"right",alignSelf:"center",fontSize:"12px"}},o.createElement("b",null,r.getFieldValue(l)[e.name].qty)," kg"),o.createElement(s.mZ,{style:O({textAlign:"right",alignSelf:"center",fontSize:"12px"},r.getFieldValue(l)[e.name].qty<=r.getFieldValue(l)[e.name].qty_available&&{color:"#237804"})},o.createElement("b",null,r.getFieldValue(l)[e.name].qty_available)," kg"),o.createElement(s.mZ,{style:{alignSelf:"center",fontSize:"12px"}},o.createElement(v.Z,{size:2,wrap:!0},(null===(i=r.getFieldValue(l)[e.name])||void 0===i?void 0:i.lotes)&&(null===(c=r.getFieldValue(l)[e.name])||void 0===c?void 0:c.lotes.map((function(e,t){return o.createElement(E.Z,{style:{fontSize:"11px",padding:"2px"},closable:!0,key:"lot-".concat(t),color:"orange"},e.lote," ",o.createElement("b",null,e.qty)," ",e.unit.toLowerCase())})))))))})))}))};const L=function(e){var t,r,n=e.record,a=(e.setFormTitle,e.parentRef),l=e.closeParent,c=(e.parentReload,e.wrapForm),E=void 0===c?"form":c,w=e.forInput,k=void 0===w||w,C=x(y.Z.useForm(),1)[0],F=x((0,o.useState)(!0),2),S=(F[0],F[1]),_=x((0,o.useState)({}),2),B=(_[0],_[1]),q=x((0,o.useState)({error:[],warning:[],info:[],success:[]}),2),L=q[0],j=(q[1],x((0,o.useState)(!1),2)),z=j[0],V=j[1],M=x((0,o.useState)((t=n.artigospecs_id)?{key:"update",values:{id:t}}:{key:"insert",values:{}}),2),D=M[0],N=(M[1],x((0,o.useState)({status:"none"}),2)),U=N[0],Q=N[1],K=x((0,o.useState)([]),2),Y=K[0],J=K[1],G=(0,o.useRef)(),W=x([r=(0,o.useRef)(null),function(){r.current&&r.current.focus()}],2),H=W[0],$=W[1],X=x((0,o.useState)("A"),2),ee=X[0],te=X[1],re=(0,b.ZP)("".concat(u.Uo.url,"/lotespick"),{onOpen:function(){},queryParams:{token:"123456"},onError:function(e){},shouldReconnect:function(e){return!0},reconnectInterval:3e3}),ne=re.lastJsonMessage,ae=re.sendJsonMessage,oe=function(e){var t=e.lookup,r=void 0!==t&&t,a=e.token;R(regeneratorRuntime.mark((function e(){var t,o,l,i,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=6;break}return e.t0=J,e.next=4,P({token:a});case 4:e.t1=e.sent,(0,e.t0)(e.t1);case 6:if(t=n.formulacao.items.map((function(e){var t=e.matprima_cod;return"'".concat(t,"'")})).join(","),ae({cmd:"loadmatprimas",value:t,cs:n.id}),o=n.nonwovens.nw_des_sup.split(new RegExp("gsm","i"))[0].trim().split(" ").pop(),l=n.nonwovens.nw_des_inf.split(new RegExp("gsm","i"))[0].trim().split(" ").pop(),i=Number(n.quantity.square_meters)*(Number(o)+Number(l))/Number(n.produto.gsm),u={A:[],B:[],C:[]},!(n.lotes&&n.lotes.length>0)){e.next=22;break}throw"TODO---------";case 22:n.formulacao.items.forEach((function(e){var t={qty_available:0,lotes:[],qty:Math.round(i*(Number(e.vglobal)/100),2),type:0,extrusora:e.extrusora,matprima_cod:e.matprima_cod};"BC"===e.extrusora?(u.B.push(O(O({},t),{},{extrusora:"B"})),u.C.push(O(O({},t),{},{extrusora:"C"}))):u[e.extrusora].push(t)}));case 23:C.setFieldsValue({lotesA:u.A,lotesB:u.B,lotesC:u.C}),S(!1);case 25:case"end":return e.stop()}}),e)})))()};(0,o.useEffect)((function(){var e=(0,i.BO)();return oe({lookup:!0,token:e}),function(){return e.cancel("Form Lotes Cancelled")}}),[]);var le=function(){var e=R(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ie=function(){l()};(0,o.useEffect)((function(){if(ne&&ne.length>0){var e=[],t=[],r=[],n=-1;"A"===ee?(e.push.apply(e,h(C.getFieldValue("lotesA"))),(n=e.findIndex((function(e){return"A"===e.extrusora&&e.matprima_cod===ne[0].ITMREF_0})))>=0&&-1===e[n].lotes.findIndex((function(e){return e.lote===ne[0].LOT_0}))&&(e[n].lotes=[].concat(h(e[n].lotes),[{lote:ne[0].LOT_0,qty:Math.round(ne[0].QTYPCU_0,2),unit:ne[0].PCUORI_0}]),e[n].qty_available=e[n].lotes.reduce((function(e,t){return t.qty+e}),0),C.setFieldsValue({lotesA:e}))):(t.push.apply(t,h(C.getFieldValue("lotesB"))),r.push.apply(r,h(C.getFieldValue("lotesC"))),(n=t.findIndex((function(e){return"B"===e.extrusora&&e.matprima_cod===ne[0].ITMREF_0})))>=0&&-1===t[n].lotes.findIndex((function(e){return e.lote===ne[0].LOT_0}))&&(t[n].lotes=[].concat(h(t[n].lotes),[{lote:ne[0].LOT_0,qty:Math.round(ne[0].QTYPCU_0,2),unit:ne[0].PCUORI_0}]),t[n].qty_available=t[n].lotes.reduce((function(e,t){return t.qty+e}),0),r[n].lotes=[].concat(h(r[n].lotes),[{lote:ne[0].LOT_0,qty:Math.round(ne[0].QTYPCU_0,2),unit:ne[0].PCUORI_0}]),r[n].qty_available=r[n].lotes.reduce((function(e,t){return t.qty+e}),0),C.setFieldsValue({lotesB:t,lotesC:r})))}H.current.value=""}),[ne]);return o.createElement(o.Fragment,null,o.createElement(f.Z,{result:U,successButtonOK:"insert"===D.key&&o.createElement(g.Z,{type:"primary",key:"goto-of",onClick:function(){"insert"===D.key&&(C.resetFields(),oe(),Q({status:"none"}))}},"Lotes de Matérias Primas"),successButtonClose:o.createElement(g.Z,{key:"goto-close",onClick:function(){return ie(!0)}},"Fechar"),errorButtonOK:o.createElement(g.Z,{type:"primary",key:"goto-ok",onClick:function(){Q({status:"none"})}},"OK"),errorButtonClose:o.createElement(g.Z,{key:"goto-close",onClick:ie},"Fechar")},o.createElement(s.NH,{id:"el-external"}),o.createElement(m.Z,{formStatus:L}),o.createElement(y.Z,{form:C,name:"flotes",onFinish:le,onValuesChange:function(e){B(e)},component:E},o.createElement(s.lt,{id:"LAY-LOTES",guides:z,layout:"vertical",style:{width:"100%",padding:"0px",height:"65vh"},schema:A,field:{forInput:k,wide:[16],margin:"2px",overflow:!1,guides:!1,label:{enabled:!0,pos:"top",align:"start",vAlign:"center",wrap:!1,overflow:!1,colon:!0,ellipsis:!0},alert:{pos:"right",tooltip:!0,container:!1},layout:{top:"",right:"",center:"",bottom:"",left:""},required:!0,style:{alignSelf:"top"}},fieldSet:{guides:!1,wide:16,margin:"2px",layout:"horizontal",overflow:!1}},o.createElement(s.C3,{wide:16,margin:!1,field:{wide:[4,6,6]}},o.createElement(s.mZ,{label:{enabled:!1},style:{textAlign:"center"}},o.createElement(I,{setExtrusora:te,extrusora:ee,setFocus:function(){return $(H)}})),o.createElement(s.mZ,{label:{enabled:!1}},o.createElement("input",{className:"ant-input ant-input-lg",ref:H,onKeyDown:function(e,t,r){9!=e.keyCode&&13!=e.keyCode||""!==H.current.value&&(e.preventDefault(),ae({cmd:"pick",value:H.current.value,cs:n.id}))},autoFocus:!0})),o.createElement(s.gN,{required:!1,layout:{center:"align-self:center;",right:"align-self:center;"},label:{enabled:!1}},o.createElement(s.Fb,{defaultActiveFirstOption:!0,placeholder:"Lote Picagem Manual",size:"large",keyField:"LOT_0",textField:"LOT_0",showSearch:!0,showArrow:!0,allowClear:!0,onSelect:function(e){ae({cmd:"pick",value:e.key,cs:n.id})},fetchOptions:function(e){return Z(e)}}))),o.createElement(d.Z,null,o.createElement(s.C3,{layout:"horizontal",margin:!1},o.createElement(s.C3,{layout:"vertical",split:2,margin:!1},o.createElement(T,{id:"A",form:C,extrusoraRef:G,matPrimasLookup:Y})),o.createElement(s.C3,{layout:"vertical",split:2,margin:!1},o.createElement(T,{id:"B",form:C,extrusoraRef:G,matPrimasLookup:Y}),o.createElement(T,{id:"C",form:C,extrusoraRef:G,matPrimasLookup:Y})))))),a&&o.createElement(p.Z,{elId:a.current},o.createElement(v.Z,null,o.createElement(g.Z,{type:"primary",onClick:function(){return C.submit()}},"Registar"),o.createElement(g.Z,{onClick:function(){return V(!z)}},z?"No Guides":"Guides")))))}}}]);
//# sourceMappingURL=91fc9aa3e623786d47d4.chunk.js.map
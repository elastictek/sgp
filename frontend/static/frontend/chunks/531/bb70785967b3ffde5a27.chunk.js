"use strict";(self.webpackChunksgp=self.webpackChunksgp||[]).push([[531],{48531:(e,t,r)=>{r.r(t),r.d(t,{default:()=>X});r(82526),r(41817),r(32165),r(78783),r(47042),r(91038),r(69070),r(47941),r(38880),r(89554),r(54747),r(49337),r(33321),r(88674),r(82772),r(57327),r(41539),r(85827),r(66992),r(33948),r(21249),r(68309),r(74916),r(15306),r(27207),r(79753),r(35666);var n=r(67294),o=(r(27484),r(42705),r(42919)),a=r(23455),i=r(28479),l=r(54397),c=r(96579),u=r(11382),s=r(71577),f=r(92080),d=r(32787),m=r(70507),p=r(7085),g=r(8212),b=(r(69826),r(69720),r(43290),r(9653),r(26541),r(92222),r(22262)),y=r(63386),v=(r(96641),r(26402),r(5368)),h=r(19650),w=r(82452),E=r(99555),x=r(76922),O=r(32445),S=r(20195);function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){j(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function C(e,t,r,n,o,a,i){try{var l=e[a](i),c=l.value}catch(e){return void r(e)}l.done?t(c):Promise.resolve(c).then(n,o)}function P(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||F(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,o,a=[],i=!0,l=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(l)throw o}}return a}(e,t)||F(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){if(e){if("string"==typeof e)return A(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?A(e,t):void 0}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var I=function(e,t){return(0,y.J1)({},e,t).unknown(!0)},D=(0,b.QM)({bobine:{cursor:"move",border:"solid 1px #bfbfbf",height:"150px",boxShadow:"2px 1px 2px #f0f0f0",margin:"3px",borderRadius:"3px",width:function(e){return"".concat(e.width,"%")},"&:hover":{backgroundColor:"#e6f7ff"}}}),Z=function(e){var t=e.id,r=e.value,o=e.index,a=e.moveBobine,i=e.width,l=void 0===i?0:i,c=e.forInput,u=void 0!==c&&c,s=e.cortes,f=D({width:l}),d=(0,n.useRef)(null),m=s.find((function(e){return e.item_lar==r})),p={color:m.color,fontStyle:"italic",height:"70%",display:"flex",justifyContent:"center",alignItems:"center"},g=R((0,w.L)({accept:"bobine",collect:function(e){return{handlerId:e.getHandlerId()}},drop:function(e,t){var r;if(d.current){var n=e.index,i=o;if(n!==i){var l=null===(r=d.current)||void 0===r?void 0:r.getBoundingClientRect();l.bottom,l.top,t.getClientOffset().y,l.top;a(n,i),e.index=i}}}}),2),b=g[0].handlerId,y=g[1],v=R((0,E.c)({type:"bobine",item:function(){return{id:t,index:o}},canDrag:function(e){return u},collect:function(e){return{isDragging:e.isDragging()}}}),2),h=v[0].isDragging?0:1;return(0,v[1])(d),y(d),n.createElement("div",{ref:d,className:f.bobine,style:{opacity:h,background:m.bcolor,color:m.color},"data-handler-id":b},n.createElement("div",{style:{fontSize:"10px",textAlign:"center"}},o+1),n.createElement("div",{style:p},r))};const T=function(e){var t=e.record,r=e.setFormTitle,c=e.parentRef,u=e.closeParent,m=e.parentReload,p=e.wrapForm,g=void 0===p?"form":p,b=e.forInput,y=void 0===b||b,w=R(f.Z.useForm(),1)[0],E=R((0,n.useState)(!0),2),_=(E[0],E[1],R((0,n.useState)(!1),2)),j=_[0],F=_[1],A=R((0,n.useState)({error:[],warning:[],info:[],success:[]}),2),D=A[0],T=A[1],N=R((0,n.useState)(!1),2),V=N[0],z=(N[1],R((0,S.x)([]),2)),L=z[0],W=z[1],J=R((0,n.useState)(0),2),q=J[0],B=J[1];(0,n.useEffect)((function(){!function(){var e=t.cortes,n=t.cortesOrdem;r&&r({title:"Posicionar Cortes"});var o=e[0].largura_json,a=[],i=0;if(n){var l=JSON.parse(n.largura_ordem);a.push.apply(a,P(l)),w.setFieldsValue({designacao:n.designacao}),i=l.reduce((function(e,t){return Number(e)+Number(t)}))}else for(var c=0,u=Object.entries(JSON.parse(o));c<u.length;c++){var s=R(u[c],2),f=s[0],d=s[1];a.push.apply(a,P(new Array(d).fill(f))),i+=d*f}W(a),B(i)}()}),[t]);var M=function(){var e,r=(e=regeneratorRuntime.mark((function e(r){var n,i,l,c,s,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={error:[],warning:[],info:[],success:[]},i=t.cortes,l=t.ordem,c=i[0].cortes_id,s=!1,l&&JSON.parse(l.largura_ordem).every((function(e,t){return e===L[t]}))||(s=!0),!s){e.next=11;break}return e.next=8,(0,o.SD)({url:"".concat(a.T5,"/updatecortesordem/"),parameters:k(k({},r),{},{largura_ordem:JSON.stringify(L),cortes_id:c})});case 8:"error"!==(f=e.sent).data.status?(n.success.push({message:f.data.title}),m({},"lookup"),u()):n.error.push({message:f.data.title}),T(n);case 11:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){C(a,n,o,i,l,"next",e)}function l(e){C(a,n,o,i,l,"throw",e)}i(void 0)}))});return function(e){return r.apply(this,arguments)}}(),U=(0,n.useCallback)((function(e,t){W((function(r){var n=r[t];r[t]=r[e],r[e]=n}))}),[L]),Q=(0,n.useCallback)((function(){F(!0),w.submit()}),[]);return n.createElement(n.Fragment,null,n.createElement(l.Z,{formStatus:D}),n.createElement(f.Z,{form:w,name:"fps",onFinish:M,component:g},n.createElement(i.lt,{id:"LAY-CORTESORDEM-UPSERT",guides:V,layout:"vertical",style:{width:"100%",padding:"0px"},schema:I,field:{forInput:y,wide:[16],margin:"2px",overflow:!1,guides:V,label:{enabled:!0,pos:"top",align:"start",vAlign:"center",wrap:!1,overflow:!1,colon:!0,ellipsis:!0},alert:{pos:"right",tooltip:!0,container:!1},layout:{top:"",right:"",center:"",bottom:"",left:""},required:!0,style:{alignSelf:"top"}},fieldSet:{guides:V,wide:16,margin:"2px",layout:"horizontal",overflow:!1}},y&&n.createElement(n.Fragment,null,n.createElement(i.C3,{margin:!1,field:{wide:[6,4]}},n.createElement(i.gN,{name:"designacao",label:{enabled:!1}},n.createElement(d.Z,{placeholder:"Designação",size:"small"}))),n.createElement(i.qL,{height:"24px"})))),n.createElement(x.W,{backend:O.PD},n.createElement("div",{style:{display:"flex",flexDirection:"row"}},L.map((function(e,r){return n.createElement(Z,{key:"b-".concat(e,".").concat(r),id:"b-".concat(e,".").concat(r),value:e,index:r,moveBobine:U,width:100*e/q,cortes:t.cortes,forInput:y})})))),c&&n.createElement(v.Z,{elId:c.current},n.createElement(h.Z,null,n.createElement(s.Z,{disabled:j,onClick:Q,type:"primary"},"Guardar"))))};var N=r(36904),V=["form","guides","schema"];function z(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Q(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(l)throw a}}}}function L(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function W(e,t,r,n,o,a,i){try{var l=e[a](i),c=l.value}catch(e){return void r(e)}l.done?t(c):Promise.resolve(c).then(n,o)}function J(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){W(a,n,o,i,l,"next",e)}function l(e){W(a,n,o,i,l,"throw",e)}i(void 0)}))}}function q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function B(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?q(Object(r),!0).forEach((function(t){M(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function M(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function U(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,o,a=[],i=!0,l=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(l)throw o}}return a}(e,t)||Q(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(e,t){if(e){if("string"==typeof e)return Y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Y(e,t):void 0}}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var $=[{bcolor:"#002766",color:"#ffffff"},{bcolor:"#0050b3",color:"#ffffff"},{bcolor:"#1890ff",color:"#000000"},{bcolor:"#69c0ff",color:"#000000"},{bcolor:"#bae7ff",color:"#000000"},{bcolor:"#ffffff",color:"#000000"}],G=function(e){var t=e.showWrapper,r=e.setShowWrapper,o=e.parentReload,a=U((0,n.useState)({}),2),l=a[0],c=a[1],u=(0,n.useRef)(),s=t.record,f=void 0===s?{}:s,d=function(){r((function(e){return B(B({},e),{},{show:!e.show})}))};return n.createElement(i.JE,{title:n.createElement(i.QF,{title:l.title,subTitle:l.subTitle}),type:"drawer",destroyOnClose:!0,mask:!0,setVisible:d,visible:t.show,width:800,bodyStyle:{height:"450px"},footer:n.createElement("div",{ref:u,id:"form-wrapper",style:{textAlign:"right"}})},n.createElement(T,{setFormTitle:c,record:f,parentRef:u,closeParent:d,parentReload:o}))},H=function(){var e=J(regeneratorRuntime.mark((function e(t){var r,n,i,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.agg_id,n=t.token,e.next=3,(0,o.SD)({url:"".concat(a.T5,"/artigostempagglookup/"),filter:{agg_id:r},sort:[],cancelToken:n});case 3:return i=e.sent,l=i.data.rows,e.abrupt("return",l);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=J(regeneratorRuntime.mark((function e(t){var r,n,i,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.cortes_id,n=t.token,e.next=3,(0,o.SD)({url:"".concat(a.T5,"/cortesordemlookup/"),filter:{cortes_id:r},sort:[],cancelToken:n});case 3:return i=e.sent,l=i.data.rows,e.abrupt("return",l);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();const X=function(e){var t=e.changedValues,r=U((0,n.useState)(!0),2),b=r[0],y=r[1],v=U((0,n.useState)({show:!1}),2),h=v[0],w=v[1],E=U((0,n.useState)(!1),2),x=(E[0],E[1],U((0,n.useState)({error:[],warning:[],info:[],success:[]}),2)),O=x[0],S=x[1],_=U((0,n.useState)([]),2),k=_[0],j=_[1],C=U((0,n.useState)(),2),P=C[0],R=C[1],F=(0,n.useContext)(N.OFabricoContext),A=F.form,I=F.guides,D=F.schema,Z=L(F,V);(0,n.useEffect)((function(){var e=(0,o.BO)();return M({agg_id:Z.agg_id,token:e}),function(){return e.cancel("Form Cortes Cancelled")}}),[]),(0,n.useEffect)((function(){t&&"cortes"in t&&R(q(A.getFieldValue("cortes")))}),[t]);var W=function(){var e=A.getFieldValue("cortesordem_id");return(e?k.filter((function(t){return t.id===e})):[])[0]},q=(0,n.useCallback)((function(e){return e.reduce((function(e,t){return e+t.item_ncortes*t.item_lar}),0)})),M=function(e){var t=e.agg_id,r=e.token,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"init";if("lookup"===n)J(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K({cortes_id:A.getFieldValue("cortes_id"),token:r});case 2:t=e.sent,j(t);case 4:case"end":return e.stop()}}),e)})))();else b||y(!0),J(regeneratorRuntime.mark((function e(){var n,o,a,i,l,c,u,s,f,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H({agg_id:t,token:r});case 2:if((n=e.sent).length>0){o=z(n.entries());try{for(o.s();!(a=o.n()).done;)i=U(a.value,2),l=i[0],c=i[1],null!=(u=JSON.parse(c.largura_json))&&(c.item_ncortes=u[c.item_lar],c.bcolor=$[l].bcolor,c.color=$[l].color)}catch(e){o.e(e)}finally{o.f()}}return s=n.length>0?n[0].cortes_id:null,f=n.length>0?n[0].cortesordem_id:null,e.next=8,K({cortes_id:s,token:r});case 8:d=e.sent,A.setFieldsValue(B(B({cortes:n},s?{cortes_id:s}:{cortes_id:null}),f?{cortesordem_id:f}:{cortesordem_id:null})),R(q(n)),j(d),y(!1);case 13:case"end":return e.stop()}}),e)})))()},Q=(0,n.useCallback)(J(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={error:[],warning:[],info:[],success:[]},e.next=3,(0,o.SD)({url:"".concat(a.T5,"/newcortes/"),parameters:B(B({},A.getFieldsValue(["cortes"])),{},{agg_id:Z.agg_id})});case 3:"error"==(r=e.sent).data.status?t.error.push({message:r.data.title}):(t.success.push({message:r.data.title}),M({agg_id:Z.agg_id})),S(t);case 6:case"end":return e.stop()}}),e)}))),[]),Y=function(){var e=J(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={error:[],warning:[],info:[],success:[]},e.next=3,(0,o.SD)({url:"".concat(a.T5,"/clearcortes/"),parameters:{agg_id:Z.agg_id}});case 3:"error"==(r=e.sent).data.status?t.error.push({message:r.data.title}):(t.success.push({message:r.data.title}),M({agg_id:Z.agg_id})),S(t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),X=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];w(e?function(e){return B(B({},e),{},{show:!e.show,record:B({},A.getFieldsValue(["cortes","cortes_id"]))})}:function(e){return B(B({},e),{},{show:!e.show,record:B(B({},A.getFieldsValue(["cortes","cortes_id"])),{},{cortesOrdem:W()})})})};return n.createElement(n.Fragment,null,n.createElement(l.Z,{formStatus:O}),n.createElement(u.Z,{spinning:b,indicator:n.createElement(p.Z,{style:{fontSize:24},spin:!0}),tip:"A carregar..."},n.createElement(G,{showWrapper:h,setShowWrapper:w,parentReload:M}),n.createElement(i.lt,{id:"LAY-CORTES",guides:I,layout:"vertical",style:{width:"100%",padding:"0px"},schema:D,field:{margin:"2px",overflow:!1,guides:I,label:{enabled:!0,pos:"top",align:"start",vAlign:"center",wrap:!1,overflow:!1,colon:!0,ellipsis:!0},alert:{pos:"right",tooltip:!0,container:!0},layout:{top:"",right:"",center:"",bottom:"",left:""},addons:{},required:!0,style:{alignSelf:"center"}},fieldSet:{guides:I,wide:16,margin:!1,layout:"horizontal",overflow:!1}},n.createElement(i.C3,null,A.getFieldValue("cortes_id")&&n.createElement(c.Z,{style:{width:"100%"},left:n.createElement("div",null,P&&n.createElement(n.Fragment,null,"Largura Útil [ ",n.createElement("b",null,P,"mm")," ]")),right:n.createElement(s.Z,{onClick:Y},"Refazer Cortes")})),n.createElement(i.C3,null,n.createElement(i.C3,{layout:"vertical",style:{minWidth:"200px",maxWidth:"200px"}},n.createElement(i.C3,{style:{fontWeight:500},field:{wide:[8,8],noItemWrap:!0,label:{enabled:!1}}},n.createElement(i.gN,null,"Largura"),n.createElement(i.gN,null,"Nº Cortes")),n.createElement(f.Z.List,{name:"cortes"},(function(e,t){t.add,t.remove,t.move;return n.createElement(n.Fragment,null,e.map((function(e,t){return n.createElement(i.C3,{key:e.key,field:{wide:[8,8]}},n.createElement(i.gN,{forInput:!1,name:[e.name,"item_lar"],label:{enabled:!1}},n.createElement(d.Z,{disabled:!0,size:"small"})),n.createElement(i.gN,{name:[e.name,"item_ncortes"],label:{enabled:!1}},n.createElement(m.Z,{size:"small",min:1,max:24})))})))})),n.createElement(i.qL,{height:"12px"}),n.createElement(i.C3,null,n.createElement(s.Z,{disabled:!(!A.getFieldValue("cortes_id")||t&&"cortes"in t),type:"dashed",onClick:Q,style:{width:"100%"}},"Aplicar")))),n.createElement(i.qL,{height:"12px"}),n.createElement(i.C3,null,A.getFieldValue("cortes_id")&&n.createElement(c.Z,{style:{width:"100%"},left:n.createElement(i.C3,null,n.createElement(i.gN,{name:"cortesordem_id",layout:{center:"align-self:center;",right:"align-self:center;"},label:{enabled:!0,text:"Posição Cortes",pos:"left"},addons:B({},A.getFieldValue("cortesordem_id")&&{right:n.createElement(s.Z,{onClick:function(){return X()},style:{marginLeft:"3px"},size:"small"},n.createElement(g.Z,{style:{fontSize:"16px"}}))})},n.createElement(i.mg,{allowClear:!0,size:"small",data:k,keyField:"id",textField:"designacao",optionsRender:function(e,t,r){return{label:n.createElement("div",null,n.createElement("div",{style:{display:"flex"}},n.createElement("div",{style:{minWidth:"150px"}},n.createElement("b",null,e[r])),n.createElement("div",null,"v.",e.versao)),n.createElement("div",{style:{color:"#1890ff"}},e.largura_ordem.replaceAll('"'," "))),value:e[t]}}}))),right:n.createElement(s.Z,{onClick:function(){return X(!0)}},"Novo Posicionamento de Cortes")})),n.createElement(i.C3,{field:{wide:[16]}},n.createElement(i.mZ,{label:{enabled:!1}},function(e,t){if(!e&&t)return n.createElement(T,{record:B(B({},A.getFieldsValue(["cortes","cortes_id"])),{},{cortesOrdem:t}),wrapForm:!1,forInput:!1,parentReload:M})}(b,W()))))))}}}]);
//# sourceMappingURL=bb70785967b3ffde5a27.chunk.js.map
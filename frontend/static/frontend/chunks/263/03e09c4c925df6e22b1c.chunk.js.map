{"version":3,"file":"chunks/263/03e09c4c925df6e22b1c.chunk.js","mappings":"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","sources":["webpack://sgp/./src/pages/currentline/FormSpecsUpsert.jsx"],"sourcesContent":["import React, { useEffect, useState, useCallback, useRef, useMemo, useContext } from 'react';\r\nimport { createUseStyles } from 'react-jss';\r\nimport styled from 'styled-components';\r\nimport dayjs from 'dayjs';\r\nimport Joi from 'joi';\r\nimport { fetch, fetchPost, cancelToken } from \"utils/fetch\";\r\nimport { API_URL } from \"config\";\r\nimport { getSchema } from \"utils/schemaValidator\";\r\nimport { FormLayout, Field, FieldSet, FieldItem, AlertsContainer, Item, SelectField, CheckboxField, HorizontalRule, VerticalSpace, InputAddon, SelectDebounceField } from \"components/formLayout\";\r\nimport AlertMessages from \"components/alertMessages\";\r\nimport ResultMessage from 'components/resultMessage';\r\nimport Portal from \"components/portal\";\r\nimport Toolbar from \"components/toolbar\";\r\nimport { Input, Space, Form, Button, InputNumber, DatePicker, Select, Spin } from \"antd\";\r\nimport { DATE_FORMAT, DATETIME_FORMAT, ARTIGOS_SPECS } from 'config';\r\nconst artigoSpecsItems = ARTIGOS_SPECS.filter(v => !v?.disabled);\r\n\r\nconst schema = (keys, excludeKeys) => {\r\n    return getSchema({}, keys, excludeKeys).unknown(true);\r\n}\r\n\r\nconst setId = (id) => {\r\n    if (id) {\r\n        return { key: \"update\", values: { id } };\r\n    }\r\n    return { key: \"insert\", values: {} };\r\n}\r\n\r\nconst loadCustomersLookup = async (value) => {\r\n    const { data: { rows } } = await fetchPost({ url: `${API_URL}/sellcustomerslookup/`, pagination: { limit: 10 }, filter: { [\"fmulti_customer\"]: `%${value.replaceAll(' ', '%%')}%` } });\r\n    return rows;\r\n}\r\nconst loadArtigosSpecsLookup = async ({ produto_id, token }) => {\r\n    const { data: { rows } } = await fetchPost({ url: `${API_URL}/artigosspecslookup/`, filter: { produto_id }, sort: [], cancelToken: token });\r\n    return rows;\r\n}\r\nconst getArtigoSpecsItems = async ({ artigospecs_id, token }) => {\r\n    if (!artigospecs_id) {\r\n        return [];\r\n    }\r\n    const { data: { rows } } = await fetchPost({ url: `${API_URL}/artigospecsitemsget/`, filter: { artigospecs_id }, sort: [], cancelToken: token });\r\n    return rows;\r\n}\r\nexport default ({ record, setFormTitle, parentRef, closeParent, parentReload, wrapForm = \"form\", forInput = true }) => {\r\n    const [form] = Form.useForm();\r\n    const [loading, setLoading] = useState(true);\r\n    const [isTouched, setIsTouched] = useState(false);\r\n    const [changedValues, setChangedValues] = useState({});\r\n    const [formStatus, setFormStatus] = useState({ error: [], warning: [], info: [], success: [] });\r\n    const [guides, setGuides] = useState(false);\r\n    const [operation, setOperation] = useState(setId(record.artigospecs.id));\r\n    const [resultMessage, setResultMessage] = useState({ status: \"none\" });\r\n    const [customerLookup, setCustomerLookup] = useState([]);\r\n    const [artigosSpecs, setArtigosSpecs] = useState([]);\r\n\r\n    const transformData = ({ items, artigospecs }) => {\r\n        const fieldsValue = { nitems: items.length };\r\n        for (let [i, v] of items.entries()) {\r\n            fieldsValue[`key-${i}`] = v.item_key;\r\n            fieldsValue[`des-${i}`] = v.item_des;\r\n            fieldsValue[`nv-${i}`] = v.item_nvalues;\r\n            const vals = (typeof v.item_values === \"string\") ? JSON.parse(v.item_values) : v.item_values;\r\n            for (let [iV, vV] of vals.entries()) {\r\n                fieldsValue[`v${v.item_key}-${iV}`] = vV;\r\n            }\r\n        }\r\n        const cliente_cod = { key: artigospecs?.cliente_cod, value: artigospecs?.cliente_cod, label: artigospecs?.cliente_nome };\r\n        return { ...artigospecs, ...fieldsValue, cliente_cod };\r\n    }\r\n\r\n    const init = (lookup = false, token) => {\r\n        (async () => {\r\n            if (lookup) {\r\n\r\n            }\r\n            if (operation.key === \"update\") {\r\n                (setFormTitle) && setFormTitle({ title: `Editar Especificações` });\r\n                const { items, ...artigospecs } = record.artigospecs;\r\n                setArtigosSpecs(await loadArtigosSpecsLookup({ produto_id: artigospecs.produto_id, token }));\r\n                form.setFieldsValue(transformData({ items, artigospecs }));\r\n            }\r\n            setLoading(false);\r\n        })();\r\n    }\r\n\r\n    useEffect(() => {\r\n        const cancelFetch = cancelToken();\r\n        init(true, cancelFetch);\r\n        return (() => cancelFetch.cancel(\"Form Specs Cancelled\"));\r\n\r\n    }, []);\r\n\r\n    const onValuesChange = async (changedValues) => {\r\n        setIsTouched(true);\r\n        if ('id' in changedValues) {\r\n            const artigospecs = artigosSpecs.find(v=>v.id===changedValues.id);\r\n            const artigoSpecsItems = await getArtigoSpecsItems({ artigospecs_id: changedValues.id });\r\n            form.setFieldsValue(transformData({ items:artigoSpecsItems, artigospecs }));\r\n        }\r\n        setChangedValues(changedValues);\r\n    }\r\n\r\n    const onFinish = async (values) => {\r\n        if (!isTouched) {\r\n            return;\r\n        }\r\n        const status = { error: [], warning: [], info: [], success: [] };\r\n        const v = schema().validate(values, { abortEarly: false });\r\n        if (!v.error) {\r\n            let error = false;\r\n            for (let k in values) {\r\n                if (values[k] === undefined && k !== \"cliente_cod\" && k !== \"designacao\") {\r\n                    error = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (error) {\r\n                status.error.push({ message: \"Os items têm de estar preenchidos!\" });\r\n            }\r\n            if (status.error.length === 0) {\r\n                const { cliente_cod: { value: cliente_cod, label: cliente_nome } = {} } = values;\r\n                const response = await fetchPost({ url: `${API_URL}/updatecurrentsettings/`, filter: { csid: record.id }, parameters: { type: 'specs', specs: { ...form.getFieldsValue(true), produto_id: record.artigospecs.produto_id, cliente_cod, cliente_nome } } });\r\n                setResultMessage(response.data);\r\n                if (response.data.status !== \"error\") {\r\n                    throw 'TODO RELOAD PARENT'\r\n                    //parentReload({ formulacao_id: record.formulacao.id }, \"init\");\r\n                }\r\n                /* const { cliente_cod: { value: cliente_cod, label: cliente_nome } = {} } = values;\r\n                const response = await fetchPost({ url: `${API_URL}/newartigospecs/`, parameters: { ...form.getFieldsValue(true), produto_id: record.formulacao.produto_id, cliente_cod, cliente_nome } });\r\n                if (response.data.status !== \"error\") {\r\n                    parentReload({ artigospecs_id: record.artigospecs_id }, \"init\");\r\n                }\r\n                setResultMessage(response.data); */\r\n            }\r\n        }\r\n        setFormStatus(status);\r\n    }\r\n\r\n    const onSuccessOK = () => {\r\n        if (operation.key === \"insert\") {\r\n            form.resetFields();\r\n            init();\r\n            setResultMessage({ status: \"none\" });\r\n        }\r\n    }\r\n\r\n    const onErrorOK = () => {\r\n        setResultMessage({ status: \"none\" });\r\n    }\r\n\r\n    const onClose = (reload = false) => {\r\n        closeParent();\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <ResultMessage\r\n                result={resultMessage}\r\n                successButtonOK={operation.key === \"insert\" && <Button type=\"primary\" key=\"goto-of\" onClick={onSuccessOK}>Criar Novas Especificações</Button>}\r\n                successButtonClose={<Button key=\"goto-close\" onClick={() => onClose(true)}>Fechar</Button>}\r\n                errorButtonOK={<Button type=\"primary\" key=\"goto-ok\" onClick={onErrorOK}>OK</Button>}\r\n                errorButtonClose={<Button key=\"goto-close\" onClick={onClose}>Fechar</Button>}\r\n            >\r\n                <AlertsContainer id=\"el-external\" />\r\n                <AlertMessages formStatus={formStatus} />\r\n                <Form form={form} name={`fps`} onFinish={onFinish} onValuesChange={onValuesChange} component={wrapForm}>\r\n                    <FormLayout\r\n                        id=\"LAY-SPECS-UPSERT\"\r\n                        guides={guides}\r\n                        layout=\"vertical\"\r\n                        style={{ width: \"100%\", padding: \"0px\"/* , minWidth: \"700px\" */ }}\r\n                        schema={schema}\r\n                        field={{\r\n                            forInput,\r\n                            wide: [16],\r\n                            margin: \"2px\", overflow: false, guides: false,\r\n                            label: { enabled: true, pos: \"top\", align: \"start\", vAlign: \"center\", /* width: \"80px\", */ wrap: false, overflow: false, colon: true, ellipsis: true },\r\n                            alert: { pos: \"right\", tooltip: true, container: false /* container: \"el-external\" */ },\r\n                            layout: { top: \"\", right: \"\", center: \"\", bottom: \"\", left: \"\" },\r\n                            required: true,\r\n                            style: { alignSelf: \"top\" }\r\n                        }}\r\n                        fieldSet={{\r\n                            guides: false,\r\n                            wide: 16, margin: \"2px\", layout: \"horizontal\", overflow: false\r\n                        }}\r\n                    >\r\n                        {forInput && <>\r\n                            <FieldSet>\r\n                                <Toolbar\r\n                                    style={{ width: \"100%\" }}\r\n                                    left={\r\n                                        <FieldSet>\r\n                                            <Field name=\"id\" layout={{ center: \"align-self:center;\", right: \"align-self:center;\" }} label={{ enabled: false, text: \"Especificações\", pos: \"left\" }}>\r\n                                                <SelectField size=\"small\" data={artigosSpecs} keyField=\"id\" textField=\"designacao\"\r\n                                                    optionsRender={(d, keyField, textField) => ({ label: <div style={{ display: \"flex\" }}><div style={{ minWidth: \"150px\" }}><b>{d[textField]}</b></div><div>v.{d[\"versao\"]}</div></div>, value: d[keyField] })}\r\n                                                />\r\n                                            </Field>\r\n                                        </FieldSet>\r\n                                    }\r\n                                    right={<div style={{ display: \"flex\", flexDirection: \"row\" }}>\r\n                                        <FieldSet style={{ minWidth: \"300px\" }} margin={false} field={{ wide: [16] }}>\r\n                                            <Field name=\"cliente_cod\" required={false} layout={{ center: \"align-self:center;\", right: \"align-self:center;\" }} label={{ enabled: false, text: \"Cliente\", pos: \"left\" }}>\r\n                                                <SelectDebounceField\r\n                                                    placeholder=\"Cliente\"\r\n                                                    size=\"small\"\r\n                                                    keyField=\"BPCNUM_0\"\r\n                                                    textField=\"BPCNAM_0\"\r\n                                                    showSearch\r\n                                                    showArrow\r\n                                                    allowClear\r\n                                                    fetchOptions={loadCustomersLookup}\r\n                                                />\r\n                                            </Field>\r\n                                        </FieldSet>\r\n                                    </div>}\r\n                                />\r\n                            </FieldSet>\r\n                            <VerticalSpace height=\"12px\" />\r\n                        </>\r\n                        }\r\n                        {!forInput && <>\r\n                            <FieldSet margin={false} field={{ wide: [16] }}>\r\n                                <Field name=\"cliente_cod\" required={false} layout={{ center: \"align-self:center;\", right: \"align-self:center;\" }} label={{ enabled: false, text: \"Cliente\", pos: \"left\" }}>\r\n                                    <SelectDebounceField\r\n                                        placeholder=\"Cliente\"\r\n                                        size=\"small\"\r\n                                        keyField=\"BPCNUM_0\"\r\n                                        textField=\"BPCNAM_0\"\r\n                                        showSearch\r\n                                        showArrow\r\n                                        allowClear\r\n                                        fetchOptions={loadCustomersLookup}\r\n                                    />\r\n                                </Field>\r\n                            </FieldSet>\r\n                            <VerticalSpace height=\"12px\" />\r\n                        </>\r\n                        }\r\n                        <FieldSet wide={16} margin={false} layout=\"vertical\">\r\n                            <FieldSet margin={false}>\r\n                                <FieldItem label={{ enabled: false }} wide={7}></FieldItem>\r\n                                <FieldSet wide={9} margin={false} style={{ minWidth: \"185px\" }}>\r\n                                    <FieldItem label={{ enabled: false }} split={3}><div style={{ textAlign: \"center\", fontWeight: 700 }}>TDS</div></FieldItem>\r\n                                    <FieldItem label={{ enabled: false }} split={50}></FieldItem>\r\n                                    <FieldItem label={{ enabled: false }} split={3}><div style={{ textAlign: \"center\", fontWeight: 700 }}>Objetivo</div></FieldItem>\r\n                                </FieldSet>\r\n                            </FieldSet>\r\n                            <FieldSet margin={false}>\r\n                                <FieldItem label={{ enabled: false }} wide={7}></FieldItem>\r\n                                <FieldSet wide={9} margin={false} style={{ minWidth: \"185px\" }}>\r\n                                    <FieldItem label={{ enabled: false }} split={6}><div style={{ textAlign: \"center\" }}>Min.</div></FieldItem>\r\n                                    <FieldItem label={{ enabled: false }} split={6}><div style={{ textAlign: \"center\" }}>Máx.</div></FieldItem>\r\n                                    <FieldItem label={{ enabled: false }} split={50}></FieldItem>\r\n                                    <FieldItem label={{ enabled: false }} split={6}><div style={{ textAlign: \"center\" }}>Min.</div></FieldItem>\r\n                                    <FieldItem label={{ enabled: false }} split={6}><div style={{ textAlign: \"center\" }}>Máx.</div></FieldItem>\r\n                                </FieldSet>\r\n                            </FieldSet>\r\n                            {artigoSpecsItems.map((v, idx) =>\r\n                                <FieldSet key={`gop-${idx}`} wide={16} field={{ wide: [7, 9] }} margin={false}>\r\n                                    <FieldItem label={{ enabled: false }} style={{ fontSize: \"11px\" }}>\r\n                                        <b>{v.designacao}</b> ({v.unidade})\r\n                                    </FieldItem>\r\n                                    <FieldSet wide={9} margin={false} style={{ minWidth: \"185px\", ...(!forInput && {fontSize:\"10px\"}) }}>\r\n                                        {[...Array(form.getFieldValue(`nv-${idx}`))].map((x, i) => {\r\n                                            if (i % 2 === 0 && i !== 0) {\r\n                                                return (\r\n                                                    <React.Fragment key={`${v.key}-${i}`}>\r\n                                                        <FieldItem label={{ enabled: false }} split={50}></FieldItem>\r\n                                                        <Field split={6} key={`${v.key}-${i}`} name={`v${v.key}-${i}`} label={{ enabled: false }}>\r\n                                                            <InputNumber min={v.min} max={v.max} controls={false} size=\"small\" precision={v?.precision} />\r\n                                                        </Field>\r\n                                                    </React.Fragment>\r\n                                                );\r\n                                            }\r\n                                            return (\r\n                                                <Field split={6} key={`${v.key}-${i}`} name={`v${v.key}-${i}`} label={{ enabled: false }}>\r\n                                                    <InputNumber min={v.min} max={v.max} controls={false} size=\"small\" precision={v?.precision} />\r\n                                                </Field>\r\n                                            );\r\n                                        }\r\n                                        )}\r\n                                    </FieldSet>\r\n                                </FieldSet>\r\n                            )}\r\n                        </FieldSet>\r\n\r\n                    </FormLayout>\r\n                </Form>\r\n                {parentRef && <Portal elId={parentRef.current}>\r\n                    <Space>\r\n                        {isTouched && <Button type=\"primary\" onClick={() => onFinish(form.getFieldsValue(true))}>Guardar</Button>}\r\n                        <Button onClick={onClose}>Fechar</Button>\r\n                    </Space>\r\n                </Portal>\r\n                }\r\n            </ResultMessage>\r\n        </>\r\n    );\r\n}"],"names":["artigoSpecsItems","ARTIGOS_SPECS","v","disabled","schema","keys","excludeKeys","getSchema","unknown","loadCustomersLookup","value","fetchPost","url","API_URL","pagination","limit","filter","replaceAll","rows","data","loadArtigosSpecsLookup","produto_id","token","sort","cancelToken","getArtigoSpecsItems","artigospecs_id","id","record","setFormTitle","parentRef","closeParent","parentReload","wrapForm","forInput","form","Form","useState","setLoading","isTouched","setIsTouched","setChangedValues","error","warning","info","success","formStatus","setFormStatus","guides","artigospecs","key","values","operation","status","resultMessage","setResultMessage","artigosSpecs","setArtigosSpecs","transformData","items","fieldsValue","nitems","length","entries","i","item_key","item_des","item_nvalues","item_values","JSON","parse","iV","vV","cliente_cod","label","cliente_nome","init","title","setFieldsValue","useEffect","cancelFetch","cancel","onValuesChange","changedValues","find","onFinish","validate","abortEarly","k","undefined","push","message","csid","parameters","type","specs","getFieldsValue","response","onClose","result","successButtonOK","onClick","resetFields","successButtonClose","errorButtonOK","errorButtonClose","name","component","layout","style","width","padding","field","wide","margin","overflow","enabled","pos","align","vAlign","wrap","colon","ellipsis","alert","tooltip","container","top","right","center","bottom","left","required","alignSelf","fieldSet","text","size","keyField","textField","optionsRender","d","display","minWidth","flexDirection","placeholder","showSearch","showArrow","allowClear","fetchOptions","height","split","textAlign","fontWeight","map","idx","fontSize","designacao","unidade","Array","getFieldValue","x","min","max","controls","precision","elId","current"],"sourceRoot":""}
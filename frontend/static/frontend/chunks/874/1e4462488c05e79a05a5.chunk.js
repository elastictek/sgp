"use strict";(self.webpackChunksgp=self.webpackChunksgp||[]).push([[874],{16874:(e,t,r)=>{r.r(t),r.d(t,{default:()=>$});r(82526),r(41817),r(32165),r(66992),r(78783),r(33948),r(47042),r(91038),r(69070),r(47941),r(38880),r(89554),r(54747),r(49337),r(33321),r(88674),r(82772),r(57327),r(41539),r(21249),r(68309),r(74916),r(15306),r(27207),r(79753),r(35666);var n=r(67294),a=(r(27484),r(42705),r(42919)),o=r(23455),i=r(19258),l=r(54397),c=r(96579),u=r(11382),s=r(71577),d=r(41003),f=r(32787),m=r(70507),p=r(7085),g=r(8212),y=(r(69720),r(43290),r(85827),r(9653),r(26541),r(92222),r(22262)),b=r(63386),v=(r(96641),r(26402),r(5368)),h=r(19650),w=r(59240),E=r(5200),O=r(81365),x=r(57865),S=r(20195);function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){j(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function C(e,t,r,n,a,o,i){try{var l=e[o](i),c=l.value}catch(e){return void r(e)}l.done?t(c):Promise.resolve(c).then(n,a)}function P(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||F(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,o=[],i=!0,l=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){l=!0,a=e}finally{try{i||null==r.return||r.return()}finally{if(l)throw a}}return o}(e,t)||F(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){if(e){if("string"==typeof e)return A(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?A(e,t):void 0}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Z=function(e,t){return(0,b.J1)({},e,t).unknown(!0)},I=(0,y.QM)({bobine:{cursor:"move",border:"solid 1px #bfbfbf",height:"150px",boxShadow:"2px 1px 2px #f0f0f0",margin:"3px",borderRadius:"3px",width:function(e){return"".concat(e.width,"%")},"&:hover":{backgroundColor:"#e6f7ff"}}}),D=function(e){var t=e.id,r=e.value,a=e.index,o=e.moveBobine,i=e.width,l=void 0===i?0:i,c=e.forInput,u=void 0!==c&&c,s=I({width:l}),d=(0,n.useRef)(null),f=R((0,w.L)({accept:"bobine",collect:function(e){return{handlerId:e.getHandlerId()}},drop:function(e,t){var r;if(d.current){var n=e.index,i=a;if(n!==i){var l=null===(r=d.current)||void 0===r?void 0:r.getBoundingClientRect();l.bottom,l.top,t.getClientOffset().y,l.top;o(n,i),e.index=i}}}}),2),m=f[0].handlerId,p=f[1],g=R((0,E.c)({type:"bobine",item:function(){return{id:t,index:a}},canDrag:function(e){return u},collect:function(e){return{isDragging:e.isDragging()}}}),2),y=g[0].isDragging?0:1;return(0,g[1])(d),p(d),n.createElement("div",{ref:d,className:s.bobine,style:{opacity:y},"data-handler-id":m},n.createElement("div",{style:{fontSize:"10px",textAlign:"center"}},a+1),n.createElement("div",{style:{color:"#1890ff",fontStyle:"italic",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}},r))};const N=function(e){var t=e.record,r=e.setFormTitle,c=e.parentRef,u=e.closeParent,m=e.parentReload,p=e.wrapForm,g=void 0===p?"form":p,y=e.forInput,b=void 0===y||y,w=R(d.Z.useForm(),1)[0],E=R((0,n.useState)(!0),2),_=(E[0],E[1],R((0,n.useState)({error:[],warning:[],info:[],success:[]}),2)),j=_[0],F=_[1],A=R((0,n.useState)(!1),2),I=A[0],N=A[1],T=R((0,S.x)([]),2),V=T[0],z=T[1],L=R((0,n.useState)(0),2),W=L[0],J=L[1];(0,n.useEffect)((function(){!function(){var e=t.cortes,n=t.cortesOrdem;r&&r({title:"Posicionar Cortes"});var a=e[0].largura_json,o=[],i=0;if(n){var l=JSON.parse(n.largura_ordem);o.push.apply(o,P(l)),w.setFieldsValue({designacao:n.designacao}),i=l.reduce((function(e,t){return Number(e)+Number(t)}))}else for(var c=0,u=Object.entries(JSON.parse(a));c<u.length;c++){var s=R(u[c],2),d=s[0],f=s[1];o.push.apply(o,P(new Array(f).fill(d))),i+=f*d}z(o),J(i)}()}),[t]);var q=function(){var e,r=(e=regeneratorRuntime.mark((function e(r){var n,i,l,c,s,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={error:[],warning:[],info:[],success:[]},i=t.cortes,l=t.ordem,c=i[0].cortes_id,s=!1,l&&JSON.parse(l.largura_ordem).every((function(e,t){return e===V[t]}))||(s=!0),!s){e.next=11;break}return e.next=8,(0,a.SD)({url:"".concat(o.T5,"/updatecortesordem/"),parameters:k(k({},r),{},{largura_ordem:JSON.stringify(V),cortes_id:c})});case 8:"error"!==(d=e.sent).data.status?(n.success.push({message:d.data.title}),m({},"lookup"),u()):n.error.push({message:d.data.title}),F(n);case 11:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){C(o,n,a,i,l,"next",e)}function l(e){C(o,n,a,i,l,"throw",e)}i(void 0)}))});return function(e){return r.apply(this,arguments)}}(),B=(0,n.useCallback)((function(e,t){z((function(r){var n=r[t];r[t]=r[e],r[e]=n}))}),[V]);return n.createElement(n.Fragment,null,n.createElement(l.Z,{formStatus:j}),n.createElement(d.Z,{form:w,name:"fps",onFinish:q,component:g},n.createElement(i.lt,{id:"LAY-CORTESORDEM-UPSERT",guides:I,layout:"vertical",style:{width:"100%",padding:"0px"},schema:Z,field:{forInput:b,wide:[16],margin:"2px",overflow:!1,guides:I,label:{enabled:!0,pos:"top",align:"start",vAlign:"center",wrap:!1,overflow:!1,colon:!0,ellipsis:!0},alert:{pos:"right",tooltip:!0,container:!1},layout:{top:"",right:"",center:"",bottom:"",left:""},required:!0,style:{alignSelf:"top"}},fieldSet:{guides:I,wide:16,margin:"2px",layout:"horizontal",overflow:!1}},b&&n.createElement(n.Fragment,null,n.createElement(i.C3,{margin:!1,field:{wide:[6,4]}},n.createElement(i.gN,{name:"designacao",label:{enabled:!1}},n.createElement(f.Z,{placeholder:"Designação",size:"small"}))),n.createElement(i.qL,{height:"24px"})))),n.createElement(O.W,{backend:x.PD},n.createElement("div",{style:{display:"flex",flexDirection:"row"}},V.map((function(e,t){return n.createElement(D,{key:"b-".concat(e,".").concat(t),id:"b-".concat(e,".").concat(t),value:e,index:t,moveBobine:B,width:100*e/W,forInput:b})})))),c&&n.createElement(v.Z,{elId:c.current},n.createElement(h.Z,null,n.createElement(s.Z,{type:"primary",onClick:function(){return w.submit()}},"Guardar"),n.createElement(s.Z,{onClick:function(){return N(!I)}},I?"No Guides":"Guides"))))};var T=r(66204),V=["form","guides","schema"];function z(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function L(e,t,r,n,a,o,i){try{var l=e[o](i),c=l.value}catch(e){return void r(e)}l.done?t(c):Promise.resolve(c).then(n,a)}function W(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){L(o,n,a,i,l,"next",e)}function l(e){L(o,n,a,i,l,"throw",e)}i(void 0)}))}}function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach((function(t){B(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function B(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function M(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,o=[],i=!0,l=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){l=!0,a=e}finally{try{i||null==r.return||r.return()}finally{if(l)throw a}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return G(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return G(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var U=function(e){var t=e.showWrapper,r=e.setShowWrapper,a=e.parentReload,o=M((0,n.useState)({}),2),l=o[0],c=o[1],u=(0,n.useRef)(),s=t.record,d=void 0===s?{}:s,f=function(){r((function(e){return q(q({},e),{},{show:!e.show})}))};return n.createElement(i.JE,{title:n.createElement(i.QF,{title:l.title,subTitle:l.subTitle}),type:"drawer",destroyOnClose:!0,mask:!0,setVisible:f,visible:t.show,width:800,bodyStyle:{height:"450px"},footer:n.createElement("div",{ref:u,id:"form-wrapper",style:{textAlign:"right"}})},n.createElement(N,{setFormTitle:c,record:d,parentRef:u,closeParent:f,parentReload:a}))},Q=function(){var e=W(regeneratorRuntime.mark((function e(t){var r,n,i,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.agg_id,n=t.token,e.next=3,(0,a.SD)({url:"".concat(o.T5,"/artigostempagglookup/"),filter:{agg_id:r},sort:[],cancelToken:n});case 3:return i=e.sent,l=i.data.rows,e.abrupt("return",l);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Y=function(){var e=W(regeneratorRuntime.mark((function e(t){var r,n,i,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.cortes_id,n=t.token,e.next=3,(0,a.SD)({url:"".concat(o.T5,"/cortesordemlookup/"),filter:{cortes_id:r},sort:[],cancelToken:n});case 3:return i=e.sent,l=i.data.rows,e.abrupt("return",l);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();const $=function(e){var t=e.changedValues,r=M((0,n.useState)(!0),2),y=r[0],b=r[1],v=M((0,n.useState)({show:!1}),2),h=v[0],w=v[1],E=M((0,n.useState)({error:[],warning:[],info:[],success:[]}),2),O=E[0],x=E[1],S=M((0,n.useState)([]),2),_=S[0],k=S[1],j=(0,n.useContext)(T.d),C=j.form,P=j.guides,R=j.schema,F=z(j,V);(0,n.useEffect)((function(){var e=(0,a.BO)();return Z({agg_id:F.agg_id,token:e}),function(){return e.cancel("Form Cortes Cancelled")}}),[]),(0,n.useEffect)((function(){}),[t]);var A=function(){var e=C.getFieldValue("cortesordem_id");return(e?_.filter((function(t){return t.id===e})):[])[0]},Z=function(e){var t=e.agg_id,r=e.token,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"init";if("lookup"===n)W(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y({cortes_id:C.getFieldValue("cortes_id"),token:r});case 2:t=e.sent,k(t);case 4:case"end":return e.stop()}}),e)})))();else y||b(!0),W(regeneratorRuntime.mark((function e(){var n,a,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q({agg_id:t,token:r});case 2:return n=e.sent,a=n.length>0?n[0].cortes_id:null,o=n.length>0?n[0].cortesordem_id:null,e.next=7,Y({cortes_id:a,token:r});case 7:i=e.sent,C.setFieldsValue(q(q({cortes:n},a?{cortes_id:a}:{cortes_id:null}),o?{cortesordem_id:o}:{cortesordem_id:null})),k(i),b(!1);case 11:case"end":return e.stop()}}),e)})))()},I=function(){var e=W(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={error:[],warning:[],info:[],success:[]},e.next=3,(0,a.SD)({url:"".concat(o.T5,"/newcortes/"),parameters:q(q({},C.getFieldsValue(["cortes"])),{},{agg_id:F.agg_id})});case 3:"error"==(r=e.sent).data.status?t.error.push({message:r.data.title}):(t.success.push({message:r.data.title}),Z({agg_id:F.agg_id})),x(t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=function(){var e=W(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={error:[],warning:[],info:[],success:[]},e.next=3,(0,a.SD)({url:"".concat(o.T5,"/clearcortes/"),parameters:{agg_id:F.agg_id}});case 3:"error"==(r=e.sent).data.status?t.error.push({message:r.data.title}):(t.success.push({message:r.data.title}),Z({agg_id:F.agg_id})),x(t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];w(e?function(e){return q(q({},e),{},{show:!e.show,record:q({},C.getFieldsValue(["cortes","cortes_id"]))})}:function(e){return q(q({},e),{},{show:!e.show,record:q(q({},C.getFieldsValue(["cortes","cortes_id"])),{},{cortesOrdem:A()})})})};return n.createElement(n.Fragment,null,n.createElement(l.Z,{formStatus:O}),n.createElement(u.Z,{spinning:y,indicator:n.createElement(p.Z,{style:{fontSize:24},spin:!0}),tip:"A carregar..."},n.createElement(U,{showWrapper:h,setShowWrapper:w,parentReload:Z}),n.createElement(i.lt,{id:"LAY-CORTES",guides:P,layout:"vertical",style:{width:"100%",padding:"0px"},schema:R,field:{margin:"2px",overflow:!1,guides:P,label:{enabled:!0,pos:"top",align:"start",vAlign:"center",wrap:!1,overflow:!1,colon:!0,ellipsis:!0},alert:{pos:"right",tooltip:!0,container:!0},layout:{top:"",right:"",center:"",bottom:"",left:""},addons:{},required:!0,style:{alignSelf:"center"}},fieldSet:{guides:P,wide:16,margin:!1,layout:"horizontal",overflow:!1}},n.createElement(i.C3,null,C.getFieldValue("cortes_id")&&n.createElement(c.Z,{style:{width:"100%"},right:n.createElement(s.Z,{onClick:D},"Refazer Cortes")})),n.createElement(i.C3,null,n.createElement(i.C3,{wide:10,layout:"vertical"},n.createElement(i.C3,{style:{fontWeight:500},field:{wide:[5,5,3,3],noItemWrap:!0,label:{enabled:!1}}},n.createElement(i.gN,null,"Ordem Fabrico"),n.createElement(i.gN,null,"Artigo"),n.createElement(i.gN,null,"Largura"),n.createElement(i.gN,null,"Nº Cortes")),n.createElement(d.Z.List,{name:"cortes"},(function(e,t){t.add,t.remove,t.move;return n.createElement(n.Fragment,null,e.map((function(e,t){return n.createElement(i.C3,{key:e.key,field:{wide:[5,5,3,3]}},n.createElement(i.gN,{forInput:!1,name:[e.name,"of_id"],label:{enabled:!1}},n.createElement(f.Z,{disabled:!0,size:"small"})),n.createElement(i.gN,{forInput:!1,name:[e.name,"item_cod"],label:{enabled:!1}},n.createElement(f.Z,{disabled:!0,size:"small"})),n.createElement(i.gN,{forInput:!1,name:[e.name,"item_lar"],label:{enabled:!1}},n.createElement(f.Z,{disabled:!0,size:"small"})),n.createElement(i.gN,{name:[e.name,"cortes_artigo_ncortes"],label:{enabled:!1}},n.createElement(m.Z,{size:"small",min:1,max:24})))})))})),n.createElement(i.qL,{height:"12px"}),n.createElement(i.C3,null,n.createElement(s.Z,{disabled:!(!C.getFieldValue("cortes_id")||t&&"cortes"in t),type:"dashed",onClick:I,style:{width:"100%"}},"Aplicar")))),n.createElement(i.qL,{height:"12px"}),n.createElement(i.C3,null,C.getFieldValue("cortes_id")&&n.createElement(c.Z,{style:{width:"100%"},left:n.createElement(i.C3,null,n.createElement(i.gN,{name:"cortesordem_id",layout:{center:"align-self:center;",right:"align-self:center;"},label:{enabled:!0,text:"Posição Cortes",pos:"left"},addons:q({},C.getFieldValue("cortesordem_id")&&{right:n.createElement(s.Z,{onClick:function(){return L()},style:{marginLeft:"3px"},size:"small"},n.createElement(g.Z,{style:{fontSize:"16px"}}))})},n.createElement(i.mg,{size:"small",data:_,keyField:"id",textField:"designacao",optionsRender:function(e,t,r){return{label:n.createElement("div",null,n.createElement("div",{style:{display:"flex"}},n.createElement("div",{style:{minWidth:"150px"}},n.createElement("b",null,e[r])),n.createElement("div",null,"v.",e.versao)),n.createElement("div",{style:{color:"#1890ff"}},e.largura_ordem.replaceAll('"'," "))),value:e[t]}}}))),right:n.createElement(s.Z,{onClick:function(){return L(!0)}},"Novo Posicionamento de Cortes")})),n.createElement(i.C3,{field:{wide:[16]}},n.createElement(i.mZ,{label:{enabled:!1}},function(e,t){if(!e&&t)return n.createElement(N,{record:q(q({},C.getFieldsValue(["cortes","cortes_id"])),{},{cortesOrdem:t}),wrapForm:!1,forInput:!1,parentReload:Z})}(y,A()))))))}}}]);
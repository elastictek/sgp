"use strict";(self.webpackChunksgp=self.webpackChunksgp||[]).push([[70],{80070:(e,t,n)=>{n.r(t),n.d(t,{default:()=>I});n(69070),n(79753),n(82526),n(41817),n(32165),n(66992),n(78783),n(33948),n(47042),n(68309),n(91038),n(47941),n(82772),n(57327),n(38880),n(89554),n(54747),n(49337),n(33321),n(74916),n(15306),n(27207),n(91058),n(92222),n(41539),n(88674),n(35666);var r=n(67294),a=(n(27484),n(42705)),l=n.n(a),o=n(42919),i=n(63386),c=n(23455),s=n(19258),m=(n(96579),n(5368)),u=n(41003),d=n(11382),p=n(70507),f=n(19650),g=n(71577),_=n(7085),b=(n(26402),n(66204),["emendas","paletesstock"]),y=["emendas","paletesstock","tempof_id"];function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){k(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,l=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(l.push(r.value),!t||l.length!==t);o=!0);}catch(e){i=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw a}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e,t,n,r,a,l,o){try{var i=e[l](o),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,a)}function S(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var l=e.apply(t,n);function o(e){O(l,r,a,o,i,"next",e)}function i(e){O(l,r,a,o,i,"throw",e)}o(void 0)}))}}var P=function(e,t){return(0,i.J1)({n_paletes_total:l().number().label("Nº Paletes Total").min(0).required(),nemendas_paletescontentor:l().number().label("Nº Emendas Por Palete/Contentor").min(0).required(),nemendas_rolo:l().number().label("Nº Emendas Por Bobine").min(0).required(),maximo:l().number().label("Percentagem Máxima de Emendas").min(0).required(),tipo_emenda:l().number().label("Tipo Emenda").required(),cliente_cod:l().object().label("Cliente").required()},e,t).unknown(!0)},C=function(){var e=S(regeneratorRuntime.mark((function e(t){var n,r,a,l,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.cliente_cod,r=t.artigo_cod,a=t.token,e.next=3,(0,o.SD)({url:"".concat(c.T5,"/emendaslookup/"),filter:{cliente_cod:n,artigo_cod:r},pagination:{limit:1},sort:[{column:"id",direction:"DESC"}],cancelToken:a});case 3:return l=e.sent,i=l.data.rows,e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=S(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.SD)({url:"".concat(c.T5,"/sellcustomerslookup/"),pagination:{limit:10},filter:k({},"fmulti_customer","%".concat(t.replaceAll(" ","%%"),"%"))});case 2:return n=e.sent,r=n.data.rows,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();const I=function(e){var t=e.record,n=e.setFormTitle,a=e.parentRef,l=e.closeParent,i=e.parentReload,E=w(u.Z.useForm(),1)[0],x=w((0,r.useState)(!1),2),k=x[0],O=x[1],I=w((0,r.useState)(!1),2),N=I[0],q=I[1],A=w((0,r.useState)([]),2),Z=(A[0],A[1],function(){var e=t.aggItem.cliente_nome?t.aggItem.cliente_nome:"";n&&n({title:"Definições ".concat(e),subTitle:"".concat(t.aggItem.of_id," - ").concat(t.aggItem.item_cod)}),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.aggItem,r=n.emendas,a=n.paletesstock,l=h(n,b),o=l.cliente_cod?{label:l.cliente_nome,cliente_cod:l.cliente_cod}:null,i=e.token;S(regeneratorRuntime.mark((function e(){var t,n,c,s,m,u,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={},r.id){e.next=10;break}return q(!0),e.next=5,C({cliente_cod:l.cliente_cod,artigo_cod:l.item_cod,token:i});case 5:(c=e.sent).length>0&&(n={emendas_id:c[0].id,nemendas_paletescontentor:c[0].paletes_contentor,maximo:c[0].maximo,tipo_emenda:parseInt(c[0].tipo_emenda),nemendas_rolo:c[0].emendas_rolo}),q(!1),e.next=11;break;case 10:n={emendas_id:r.id,nemendas_paletescontentor:r.paletes_contentor,maximo:r.maximo,tipo_emenda:parseInt(r.tipo_emenda),nemendas_rolo:r.emendas_rolo};case 11:s=JSON.parse(l.n_paletes),m=a?a.length:0,u=l.n_paletes_total?l.n_paletes_total:null!=s&&null!==(t=s.total)&&void 0!==t&&t.n_paletes?Math.round(s.total.n_paletes):m,d=u-m,E.setFieldsValue(v(v({},n),{},{n_paletes_total:u,n_paletes_stock:m,n_paletes_prod:d,cliente_cod:o}));case 16:case"end":return e.stop()}}),e)})))()}()});(0,r.useEffect)((function(){Z()}),[]);var T=function(){var e=S(regeneratorRuntime.mark((function e(n){var r,a,s,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.aggItem,r.emendas,r.paletesstock,a=r.tempof_id,s=h(r,y),P().validate(n,{abortEarly:!1}).error){e.next=8;break}return m=s.order_cod?{cliente_nome:s.cliente_nome,cliente_cod:s.cliente_cod}:{cliente_nome:n.cliente_cod.label,cliente_cod:n.cliente_cod.value},e.next=6,(0,o.SD)({url:"".concat(c.T5,"/savetempordemfabrico/"),parameters:v(v(v({type:"settings"},n),m),{},{artigo_cod:s.item_cod,ofabrico:a})});case 6:"error"!==e.sent.data.status&&(i({agg_id:s.id}),l());case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.createElement(r.Fragment,null,r.createElement(d.Z,{spinning:N,indicator:r.createElement(_.Z,{style:{fontSize:24},spin:!0}),tip:"A carregar..."},r.createElement(u.Z,{form:E,name:"form-of-settings",onFinish:T,onValuesChange:function(e,n){if("n_paletes_total"in e){var r=t.aggItem.paletesstock,a=r?r.length:0,l=e.n_paletes_total<a?a:e.n_paletes_total,o=l-a;E.setFieldsValue({n_paletes_total:l,n_paletes_prod:o})}},component:"form"},r.createElement(s.lt,{id:"LAY-SETTINGS",guides:k,layout:"vertical",style:{width:"100%",padding:"0px"},schema:P,field:{margin:"2px",overflow:!1,guides:k,label:{enabled:!0,pos:"top",align:"start",vAlign:"center",wrap:!1,overflow:!0,colon:!0,ellipsis:!0},alert:{pos:"right",tooltip:!0,container:!1},layout:{top:"",right:"",center:"",bottom:"",left:""},addons:{},required:!0,style:{alignSelf:"top"}},fieldSet:{guides:k,wide:16,margin:"2px",layout:"horizontal",overflow:!1}},r.createElement(s.bo,{title:"1. Cliente"}),r.createElement(s.qL,null),r.createElement(s.C3,{margin:!1,field:{wide:[8]}},r.createElement(s.gN,{forInput:!t.aggItem.order_cod,name:"cliente_cod",required:!1,layout:{center:"align-self:center;",right:"align-self:center;"},label:{enabled:!1,text:"Cliente",pos:"left"}},r.createElement(s.Fb,{placeholder:"Cliente",size:"small",keyField:"BPCNUM_0",textField:"BPCNAM_0",showSearch:!0,showArrow:!0,allowClear:!0,fetchOptions:j}))),r.createElement(s.qL,{height:"24px"}),r.createElement(s.bo,{title:"2. Nº de Paletes"}),r.createElement(s.qL,null),r.createElement(s.C3,{margin:!1},r.createElement(s.gN,{wide:2,name:"n_paletes_total",label:{text:"Total"}},r.createElement(p.Z,{size:"small",min:0,max:500}))),r.createElement(s.C3,{margin:!1},r.createElement(s.gN,{required:!1,wide:2,name:"n_paletes_stock",label:{text:"Stock"},forInput:!1},r.createElement(p.Z,{size:"small",min:0,max:500})),r.createElement(s.gN,{required:!1,wide:2,name:"n_paletes_prod",label:{text:"A Produzir"},forInput:!1},r.createElement(p.Z,{size:"small",min:0,max:500}))),r.createElement(s.qL,null),r.createElement(s.bo,{title:"3. Emendas"}),r.createElement(s.qL,null),r.createElement(s.C3,{margin:!1,field:{wide:4,style:{alignSelf:"left"},label:{pos:"top",wrap:!1,ellipsis:!1,width:"130px"}},layout:"vertical"},r.createElement(s.gN,{name:"tipo_emenda",label:{text:"Tipo Emenda"}},r.createElement(s.mg,{size:"small",data:c.s7,keyField:"key",textField:"value"})),r.createElement(s.C3,{margin:!1},r.createElement(s.gN,{wide:2,name:"maximo",label:{text:"Máximo"}},r.createElement(p.Z,{size:"small",addonAfter:r.createElement("b",null,"%"),min:0,max:100})),r.createElement(s.gN,{wide:2,label:{text:"Emendas/Rolo"},name:"nemendas_rolo"},r.createElement(p.Z,{size:"small",min:0,max:100})),r.createElement(s.gN,{wide:2,overflow:!0,label:{text:"Paletes/Contentor"},name:"nemendas_paletescontentor"},r.createElement(p.Z,{size:"small",min:0,max:100})))))),a&&r.createElement(m.Z,{elId:a.current},r.createElement(f.Z,null,r.createElement(g.Z,{type:"primary",onClick:function(){return E.submit()}},"Guardar"),r.createElement(g.Z,{onClick:function(){return O(!k)}},k?"No Guides":"Guides")))))}}}]);
"use strict";(self.webpackChunksgp=self.webpackChunksgp||[]).push([[469],{55469:(e,t,r)=>{r.r(t),r.d(t,{default:()=>T});r(69070),r(47941),r(82772),r(82526),r(41817),r(32165),r(66992),r(78783),r(33948),r(47042),r(68309),r(91038),r(74916),r(57327),r(38880),r(89554),r(54747),r(49337),r(33321),r(85827),r(41539),r(79753),r(54678),r(56977),r(88674),r(35666);var n=r(67294),a=(r(27484),r(42705),r(42919)),l=r(23455),o=(r(63386),r(19258)),i=(r(54397),r(26402)),s=r(5368),c=r(96579),u=(r(75950),r(71577)),m=r(41003),f=r(32787),d=r(11382),g=r(19650),p=r(52110),h=r(84636),y=r(76570),v=r(47218),E=r(7085),b=["aggItem","leftColumns","rightColumns","leftDataAPI","rightDataAPI","setResultMessage"];function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){x(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function S(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,l=[],o=!0,i=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(l.push(n.value),!t||l.length!==t);o=!0);}catch(e){i=!0,a=e}finally{try{o||null==r.return||r.return()}finally{if(i)throw a}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return k(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function O(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function x(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function I(e,t,r,n,a,l,o){try{var i=e[l](o),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,a)}function A(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var l=e.apply(t,r);function o(e){I(l,n,a,o,i,"next",e)}function i(e){I(l,n,a,o,i,"throw",e)}o(void 0)}))}}u.Z.Group;var Z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.form,r=e.formName,a=e.dataAPI,l=function(e){},i=function(){var e=A(regeneratorRuntime.mark((function e(){var n,l,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=a.getFilter(),l=n.item_id,o=n.of_id,a.addFilters(x({of_id:o,item_id:l},r,t.getFieldValue(r))),a.first(),a.fetchPost();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return n.createElement(m.Z,{form:t,name:r,onFinish:i,onValuesChange:l},n.createElement(o.lt,{id:"PS-FILTER",layout:"horizontal",style:{width:"100%",padding:"0px"},field:{forInput:!0,wide:[16],margin:"2px",overflow:!1,label:{enabled:!0,pos:"top",wrap:!1,overflow:!1,colon:!0,ellipsis:!0},alert:{pos:"right",tooltip:!0,container:!1},layout:{top:"",right:"",center:"",bottom:"",left:""},required:!0,style:{alignSelf:"center"}},fieldSet:{wide:16,margin:!1,layout:"horizontal",overflow:!1,style:{alignSelf:"center"}}},n.createElement(o.gN,{name:r,label:{enabled:!1},addons:{right:n.createElement(u.Z,{size:"small",onClick:i},n.createElement(y.Z,null))}},n.createElement(f.Z,{size:"small"}))))},F=function(e){var t=e.aggItem,r=e.leftColumns,o=e.rightColumns,i=e.leftDataAPI,s=e.rightDataAPI,f=e.setResultMessage,d=(O(e,b),S(m.Z.useForm(),1)[0]),g=S(m.Z.useForm(),1)[0],h=t.tempof_id,y=t.qty_encomenda,E=S((0,n.useState)([]),2),w=E[0],k=E[1],x=S((0,n.useState)([]),2),I=x[0],F=x[1],T=S((0,n.useState)({left:{st:0,stm2:0,total:0,totalm2:0},right:{st:0,stm2:0,total:0,totalm2:0,vTotal:0,vTotalm2:0}}),2),C=T[0],D=T[1];(0,n.useEffect)((function(){if(!i.isLoading()||!s.isLoading()){var e=s.getData().rows.reduce((function(e,t){return e+(t.area||0)}),0);D((function(t){return{left:{st:0,stm2:0,total:0,totalm2:0},right:{st:0,stm2:0,vTotal:s.getData().total,vTotalm2:e,total:s.getData().total,totalm2:e}}}))}}),[i.isLoading()&&s.isLoading()]);var j=function(){var e=A(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.SD)({url:"".concat(l.T5,"/savepaletesstock/"),parameters:{id:h,left:w,right:I}});case 2:"error"!==(t=e.sent).data.status?(r=(0,a.BO)(),k([]),i.fetchPost({token:r}),s.fetchPost({token:r})):f(t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(e,t,r,n){Array.isArray(n)?e[t]=P(P({},e[t]),{},{st:n.length,stm2:n.reduce((function(e,t){return e+(t.area||0)}),0)}):r.length<=e[t].st?e[t]=P(P({},e[t]),{},{st:r.length,stm2:parseFloat(e[t].stm2)-n.area}):e[t]=P(P({},e[t]),{},{st:r.length,stm2:parseFloat(e[t].stm2)+n.area})};return n.createElement(n.Fragment,null,n.createElement("div",null,n.createElement(c.Z,{style:{width:"100%"},left:n.createElement("div",null,"Encomenda ",n.createElement("b",null,t.qty_encomenda," m²")),right:n.createElement("div",null,n.createElement("div",null,n.createElement("b",null,C.right.total)," Paletes Adicionadas"),n.createElement("div",{style:{color:y<=C.right.vTotalm2?"#389e0d":"#000"}},n.createElement("b",null,C.right.totalm2.toFixed(2)," m²")))})),n.createElement("div",{style:{display:"flex",flexDirection:"row",overflow:"hidden"}},n.createElement("div",{style:{width:"45%"}},n.createElement("div",null,n.createElement("div",null,"Paletes em Stock (",n.createElement("b",null,C.left.st)," selecionadas)"),n.createElement("div",null,n.createElement("b",null,C.left.stm2.toFixed(2)," m²"))),n.createElement(p.Z,{columnChooser:!1,reload:!1,clearSort:!1,stripRows:!0,darkHeader:!1,toolbar:n.createElement(Z,{form:d,formName:"fpl-filter",dataAPI:i}),size:"small",selection:{enabled:!0,rowKey:"id",onSelection:function(e,t){var r=P({},C);R(r,"left",e,t),r.right.vTotal=r.right.total-r.right.st+r.left.st,r.right.vTotalm2=r.right.totalm2-r.right.stm2+r.left.stm2,D(r)},multiple:!0,selectedRows:w,setSelectedRows:k},paginationProps:{pageSizeOptions:[10,15,20,30]},dataAPI:i,columns:r,onFetch:i.fetchPost})),n.createElement("div",{style:{width:"5%",textAlign:"center",alignSelf:"center"}},n.createElement(u.Z,{type:"primary",onClick:j,size:"small",icon:n.createElement(v.Z,null)})),n.createElement("div",{style:{flex:1}},n.createElement("div",{style:{display:"flex",flexDirection:"row"}},n.createElement("div",{style:{width:"50%"}},n.createElement("div",null,"Total Virtual ",n.createElement("b",null,C.right.vTotal)," Paletes"),n.createElement("div",{style:{color:y<=C.right.vTotalm2?"#389e0d":"#000"}},n.createElement("b",null,C.right.vTotalm2.toFixed(2)," m²")))),n.createElement(p.Z,{columnChooser:!1,reload:!1,clearSort:!1,stripRows:!0,darkHeader:!1,toolbar:n.createElement(Z,{form:g,formName:"fpr-filter",dataAPI:s}),size:"small",selection:{enabled:!0,rowKey:"id",onSelection:function(e,t){var r=P({},C);R(r,"right",e,t),r.right.vTotal=r.right.total-r.right.st+r.left.st,r.right.vTotalm2=r.right.totalm2-r.right.stm2+r.left.stm2,D(r)},multiple:!0,selectedRows:I,setSelectedRows:F},dataAPI:s,columns:o,onFetch:s.fetchPost,scroll:{y:465,scrollToFirstRowOnChange:!0}}))))};const T=function(e){var t,r,o=e.record,c=e.setFormTitle,f=e.parentRef,y=e.closeParent,v=(e.parentReload,e.wrapForm,e.forInput,o.aggItem),b=S(m.Z.useForm(),1)[0],w=S((0,n.useState)(!0),2),k=(w[0],w[1]),O=S((0,n.useState)({}),2),x=(O[0],O[1],S((0,n.useState)({error:[],warning:[],info:[],success:[]}),2)),I=(x[0],x[1],S((0,n.useState)(!1),2)),Z=I[0],T=I[1],C=S((0,n.useState)((t=v.of_id)?{key:"update",values:{id:t}}:{key:"insert",values:{}}),2),D=(C[0],C[1],S((0,n.useState)({status:"none"}),2)),j=D[0],R=D[1],_=(0,h.E)({payload:{url:"".concat(l.T5,"/paletesstocklookup/"),parameters:{},pagination:{enabled:!0,page:1,pageSize:15},filter:{item_id:v.item_id},sort:[]}}),z=(0,h.E)({payload:{url:"".concat(l.T5,"/paletesstockget/"),parameters:{},pagination:{enabled:!1},filter:{of_id:v.tempof_id},sort:[]}}),L=P({},{nome:P({title:"Palete",width:100,render:function(e){return n.createElement("div",{style:{fontSize:"12px",fontWeight:700}},e)}},r={idx:1,optional:!1,sort:!1}),largura_bobines:P({title:"Larg.",width:60,render:function(e){return n.createElement("div",{style:{fontSize:"10px"}},e," mm")}},r),core_bobines:P({title:"",width:20,render:function(e){return n.createElement("div",{style:{fontSize:"10px"}},e,"''")}},r),area:P({title:"Área",width:80,render:function(e){return n.createElement("div",{style:{fontSize:"10px"}},e," m²")}},r)}),B=(0,p.B)({dataAPI:_,data:_.getData().rows,uuid:"leftPaletesStock",include:L,exclude:[]}),N=(0,p.B)({dataAPI:z,data:z.getData().rows,uuid:"rightPaletesStock",include:L,exclude:[]});(0,n.useEffect)((function(){var e;e=(0,a.BO)(),A(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:c&&c({title:"Paletes em Stock ".concat(v.item_cod),subTitle:"".concat(v.cliente_nome)}),_.first(),_.fetchPost({token:e}),z.first(),z.fetchPost({token:e}),k(!1);case 6:case"end":return t.stop()}}),t)})))()}),[]);return n.createElement(n.Fragment,null,n.createElement(i.Z,{result:j,errorButtonOK:n.createElement(u.Z,{type:"primary",key:"goto-ok",onClick:function(){R({status:"none"})}},"OK"),errorButtonClose:n.createElement(u.Z,{key:"goto-close",onClick:function(){y()}},"Fechar")},n.createElement(d.Z,{spinning:_.isLoading()||z.isLoading(),indicator:n.createElement(E.Z,{style:{fontSize:24},spin:!0}),tip:"A carregar..."},_.hasData()&&z.hasData()&&n.createElement(F,{aggItem:v,leftColumns:B,rightColumns:N,leftDataAPI:_,rightDataAPI:z,setResultMessage:R})),f&&n.createElement(s.Z,{elId:f.current},n.createElement(g.Z,null,n.createElement(u.Z,{type:"primary",onClick:function(){return b.submit()}},"Guardar"),n.createElement(u.Z,{onClick:function(){return T(!Z)}},Z?"No Guides":"Guides")))))}}}]);